import{r as o,x as B,j as e,M,S,T as r,v as w,a1 as U,w as E,J,p as I,y as P,a2 as V,o as R,N as k,a3 as $,B as u,V as G,H as F,G as O,q as T,a4 as D,a5 as H,a6 as A,s as C,O as Y,Z,_ as K,$ as Q,E as W,F as X,C as ee}from"./index-b55nogiJ.js";const se=({opened:c,onClose:d,application:s,onSuccess:l})=>{const[m,j]=o.useState(!1),{reset:g,register:p,handleSubmit:v,formState:{errors:h,isValid:z}}=B({mode:"all",resolver:P($),shouldUnregister:!1,criteriaMode:"all"}),[x,f]=o.useState(null),[y,b]=o.useState(null);o.useEffect(()=>{s&&c&&(g({firstName:s.firstName,lastName:s.lastName,email:s.email,phone:s.phone||"",message:s.message||""}),f(null),b(null))},[s,c,g]);const L=n=>{const a=V(n);b(a),f(a?null:n)},N=async n=>{if(s)try{j(!0);const a=new FormData;a.append("firstName",n.firstName),a.append("lastName",n.lastName),a.append("email",n.email),n.phone&&a.append("phone",n.phone),n.message&&a.append("message",n.message),x&&a.append("resume",x),await R.put(`/api/applications/${s._id}`,a),k.show({title:"Success",message:"Application updated successfully",color:"green"}),l&&l()}catch(a){console.error(a),k.show({title:"Error",message:a.response?.data?.message||"Failed to update application",color:"red"})}finally{d(),j(!1)}};return s?e.jsx(M,{opened:c,onClose:d,title:"Edit Application",size:"lg",zIndex:1e3,children:e.jsx("form",{onSubmit:v(N),children:e.jsxs(S,{p:"lg",children:[e.jsx(r,{c:"dimmed",fz:"xs",children:"*If the employer already reviewed your application, they may not see your changes."}),e.jsx(w,{label:"First Name",required:!0,...p("firstName"),error:h.firstName?.message}),e.jsx(w,{label:"Last Name",required:!0,...p("lastName"),error:h.lastName?.message}),e.jsx(w,{label:"Email",required:!0,...p("email"),error:h.email?.message}),e.jsx(w,{label:"Phone",...p("phone"),error:h.phone?.message}),e.jsx(U,{label:"Resume/CV",description:"Upload a new resume to replace the current one",accept:"application/pdf",value:x,onChange:L,error:y,clearable:!0}),s.resumeUrl&&e.jsx(E,{href:s.resumeUrl,target:"_blank",size:"sm",children:"View Current Resume"}),e.jsx(J,{label:"Message",...p("message"),error:h.message?.message}),e.jsx(I,{type:"submit",mx:"auto",w:200,disabled:!z||!!y,loading:m,children:"Update Application"})]})})}):null},te=({opened:c,onClose:d,listing:s})=>e.jsx(M,{opened:c,onClose:d,title:"Listing Details",size:"lg",centered:!0,zIndex:1e3,children:s&&e.jsxs(S,{gap:"md",h:"100%",children:[e.jsxs(u,{p:"md",className:G.cardGradientSubtle,style:{borderRadius:"8px",marginTop:"-16px",marginLeft:"-16px",marginRight:"-16px"},children:[e.jsx(r,{fw:700,size:"lg",c:"dimmed",mb:5,children:s.companyName}),e.jsx(F,{order:2,mb:"xs",children:s.jobTitle}),e.jsx(O,{gap:"xs",children:e.jsx(T,{variant:"filled",color:"rocketOrange",children:s.workArrangement})})]}),e.jsx(D,{}),s.location&&e.jsxs(u,{children:[e.jsx(r,{fw:600,size:"sm",mb:5,children:"Location"}),e.jsxs(r,{size:"sm",children:[s.location.city,", ",H(s.location.region)]})]}),e.jsxs(u,{children:[e.jsx(r,{fw:600,size:"sm",mb:5,children:"Job Description"}),e.jsx(r,{size:"sm",style:{whiteSpace:"pre-wrap"},children:s.jobDescription})]}),s.requirements&&s.requirements.length>0&&e.jsxs(u,{children:[e.jsx(r,{fw:600,size:"sm",mb:5,children:"Requirements"}),e.jsx(A,{size:"sm",spacing:"xs",children:s.requirements.map((l,m)=>e.jsx(A.Item,{children:l},m))})]}),s.advantages&&s.advantages.length>0&&e.jsxs(u,{children:[e.jsx(r,{fw:600,size:"sm",mb:5,children:"Advantages"}),e.jsx(A,{size:"sm",spacing:"xs",children:s.advantages.map((l,m)=>e.jsx(A.Item,{children:l},m))})]}),e.jsx(D,{}),s.apply&&e.jsxs(u,{children:[e.jsx(r,{fw:600,size:"sm",mb:5,children:"How to Apply"}),s.apply.method.jobRocketSystem&&e.jsx(r,{size:"sm",children:"Apply through JobRocket's internal system"}),s.apply.method.email&&e.jsxs(e.Fragment,{children:[e.jsx(r,{size:"sm",mb:5,children:"Apply via email:"}),e.jsx(E,{href:`mailto:${s.apply.contact.email}`,target:"_blank",children:s.apply.contact.email})]}),s.apply.method.companySystem&&e.jsxs(e.Fragment,{children:[e.jsx(r,{size:"sm",mb:5,children:"Apply via external link:"}),e.jsx(E,{href:s.apply.contact.link,target:"_blank",children:s.apply.contact.link})]})]}),s.createdAt&&e.jsxs(r,{size:"xs",c:"dimmed",ta:"center",children:["Posted on ",new Date(s.createdAt).toLocaleDateString()]})]})});function ne(){const[c,d]=o.useState(!1),[s,l]=o.useState([]),[m,j]=o.useState(!1),[g,{open:p,close:v}]=C(!1),[h,z]=o.useState(null),[x,{open:f,close:y}]=C(!1),[b,L]=o.useState(null),N=Y();o.useEffect(()=>{(async()=>{d(!0);try{const i=await R.get("/api/applications/my-applications");i.data.length>0?l(i.data):j(!0)}catch(i){k.show({title:"Error",message:i.response?.data?.message||i.message,color:"red"})}finally{setTimeout(()=>{d(!1)},1e3)}})()},[]);const n=t=>{z(t),p()},a=t=>{L(t),f()},_=()=>{(async()=>{try{const i=localStorage.getItem("token")||sessionStorage.getItem("token"),q=await R.get("https://jobrocket.work/api/applications/my-applications",{headers:{"x-auth-token":i}});l(q.data)}catch{k.show({title:"Error",message:"Failed to refresh applications",color:"red"})}})()};return e.jsxs(e.Fragment,{children:[e.jsx(Z,{title:"Job Applications | JobRocket",description:"Manage your job applications on JobRocket",keywords:"job applications, manage job applications, job listings"}),c?e.jsx(K,{py:50,h:"calc(100vh - 200px)",children:e.jsx(Q,{size:"xl",variant:"oval"})}):e.jsxs(S,{w:"100%",gap:"md",children:[e.jsx(F,{ta:"center",order:2,my:15,c:"rocketRed.9",children:"Applications"}),m?e.jsx(W,{title:"No Applications Found",description:"You haven't applied to any jobs yet. Start exploring opportunities and apply to your dream job!",action:{label:"Browse Jobs",onClick:()=>N("/search")}}):null,e.jsx(X,{w:"100%",gap:"md",wrap:"wrap",align:"stretch",justify:"center",children:s.map((t,i)=>e.jsx(ee,{withBorder:!0,p:"md",w:"250px",style:{display:"flex"},children:e.jsxs(S,{h:"100%",w:"100%",justify:"space-between",style:{flex:1},children:[typeof t.listingId=="object"&&e.jsx(F,{order:5,children:t.listingId.companyName}),typeof t.listingId=="object"&&e.jsx(r,{children:t.listingId.jobTitle}),e.jsx(T,{variant:"outline",c:t.status==="rejected"?"red":t.status==="pending"?"yellow":"green",children:t.status}),e.jsxs(r,{fz:"sm",c:"dimmed",children:["Submitted on ",new Date(t.createdAt).toLocaleDateString()]}),e.jsx(I,{variant:"outline",onClick:()=>n(t.listingId),children:"View Listing"}),e.jsx(I,{variant:"outline",onClick:()=>a(t),disabled:t.status!=="pending",children:"Edit Application"})]})},i))})]}),e.jsx(te,{opened:g,onClose:v,listing:h}),e.jsx(se,{opened:x,onClose:y,application:b,onSuccess:_})]})}export{ne as MyApplications};
