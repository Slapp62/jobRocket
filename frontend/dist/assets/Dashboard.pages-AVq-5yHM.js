import{c as G,a as $,r as c,j as e,M as le,T as r,G as T,B as K,u as te,S as A,b,d as k,C as ue,e as ie,f as xe,A as q,g as de,h as ge,i as ze,n as Le,k as Ce,l as De,F as ke,m as Q,o as se,p as M,R as Fe,W as Ie,I as ae,q as N,P as V,s as oe,t as Re,L as _e,v as Ne,w as Z}from"./index-VHpNQsUs.js";import{I as ee,T as a,a as ce}from"./IconTrash-Cx-l7qM_.js";import{c as Ee}from"./getCleanedListingData-Cbsw5E8V.js";import{S as Me,l as Oe}from"./listing.joi-2be3XD0N.js";import{S as Be,T as X,I as Pe,a as qe}from"./IconUsers-DH8anY6U.js";const $e=[["path",{d:"M7 12l5 5l10 -10",key:"svg-0"}],["path",{d:"M2 12l5 5m5 -5l5 -5",key:"svg-1"}]],We=G("outline","checks","Checks",$e);const Ue=[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 7v5l3 3",key:"svg-1"}]],Ze=G("outline","clock","Clock",Ue);const Ge=[["path",{d:"M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2",key:"svg-0"}],["path",{d:"M12 14m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-1"}],["path",{d:"M14 4l0 4l-6 0l0 -4",key:"svg-2"}]],Je=G("outline","device-floppy","DeviceFloppy",Ge);const He=[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z",key:"svg-1"}],["path",{d:"M12 17v-6",key:"svg-2"}],["path",{d:"M9.5 14.5l2.5 2.5l2.5 -2.5",key:"svg-3"}]],he=G("outline","file-download","FileDownload",He);const Ve=[["path",{d:"M18 6l-12 12",key:"svg-0"}],["path",{d:"M6 6l12 12",key:"svg-1"}]],Xe=G("outline","x","X",Ve);const Ke=[["path",{d:"M7 3.34a10 10 0 1 1 -4.995 8.984l-.005 -.324l.005 -.324a10 10 0 0 1 4.995 -8.336z",key:"svg-0"}]],Y=G("filled","circle-filled","CircleFilled",Ke),je=async()=>(await $.get("/api/applications/business/dashboard/metrics")).data,Qe=async i=>{const d=new URLSearchParams(Object.entries(i).filter(([o,n])=>n!==void 0&&n!=="All").map(([o,n])=>[o,String(n)])).toString();return(await $.get(`/api/listings/business-listings?${d}`)).data},Ye=async i=>{const d=new URLSearchParams(Object.entries(i).filter(([o,n])=>n!==void 0&&n!=="All"&&n!=="all").map(([o,n])=>[o,String(n)])).toString();return(await $.get(`/api/applications/business-applications?${d}`)).data},es=async(i,d)=>(await $.patch(`/api/applications/status/${i}`,{status:d})).data,ss=async i=>(await $.delete(`/api/listings/${i}`)).data,ts=async i=>(await $.delete(`/api/applications/${i}`)).data,as=({opened:i,onClose:d,handleDelete:x,applicationId:o,applicationTitle:n})=>{const[g,p]=c.useState(!1);return e.jsxs(le,{opened:i,onClose:d,title:"Delete application",centered:!0,children:[e.jsxs(r,{children:["Are you sure you want to delete the",e.jsxs("span",{style:{fontWeight:"bold"},children:[" ",n," "]}),"application?"]}),e.jsxs(T,{mt:20,justify:"flex-end",gap:"sm",children:[e.jsx(K,{variant:"outline",onClick:d,children:"Cancel"}),e.jsx(K,{color:"red",onClick:()=>{d(),x(o)},loading:g,children:"Delete"})]})]})},ls=({dashApplications:i,searchText:d,setSearchText:x,status:o,setStatus:n,listingId:g,setListingId:p,dateFrom:z,setDateFrom:f,dateTo:j,setDateTo:y,sortOption:F,setSortOption:m,page:L,setPage:C,onStatusChange:_,listingOptions:l,updateApplicationStatus:h,newStatus:u,setNewStatus:v,handleApplicationDelete:O})=>{const[E,{open:I,close:W}]=te(!1),[B,t]=c.useState(null),U=(s,P)=>{t({id:s,title:P}),I()};return e.jsxs(e.Fragment,{children:[e.jsxs(A,{children:[e.jsxs(A,{gap:"md",hiddenFrom:"md",children:[e.jsx(b,{label:"Listing",value:g,onChange:s=>p(s),data:l}),e.jsx(k,{type:"date",label:"From",value:z||"",onChange:s=>f(s.target.value)}),e.jsx(k,{type:"date",label:"To",value:j||"",onChange:s=>y(s.target.value)}),e.jsx(b,{label:"Status",value:o,onChange:s=>n(s),data:[{value:"all",label:"All Statuses"},{value:"pending",label:"Pending"},{value:"reviewed",label:"Reviewed"},{value:"rejected",label:"Rejected"}]}),e.jsx(k,{label:"Search",value:d,onChange:s=>x(s.target.value),placeholder:"Search applications..."}),e.jsx(b,{label:"Sort",value:F,onChange:s=>m(s),data:[{value:"date-newest",label:"Newest First"},{value:"date-oldest",label:"Oldest First"},{value:"name-asc",label:"Name (A-Z)"},{value:"name-desc",label:"Name (Z-A)"}]})]}),e.jsxs(T,{justify:"center",align:"center",visibleFrom:"md",children:[e.jsx(b,{label:"Listing",w:"15%",value:g,onChange:s=>p(s),data:l}),e.jsx(k,{type:"date",label:"From",value:z||"",onChange:s=>f(s.target.value),w:"15%"}),e.jsx(k,{type:"date",label:"To",value:j||"",onChange:s=>y(s.target.value),w:"15%"}),e.jsx(b,{label:"Status",w:"15%",value:o,onChange:s=>n(s),data:[{value:"all",label:"All Statuses"},{value:"pending",label:"Pending"},{value:"reviewed",label:"Reviewed"},{value:"rejected",label:"Rejected"}]}),e.jsx(k,{label:"Search",w:"15%",value:d,onChange:s=>x(s.target.value),placeholder:"Search applications..."}),e.jsx(b,{label:"Sort",w:"15%",value:F,onChange:s=>m(s),data:[{value:"date-newest",label:"Newest First"},{value:"date-oldest",label:"Oldest First"},{value:"name-asc",label:"Name (A-Z)"},{value:"name-desc",label:"Name (Z-A)"}]})]}),i?.length===0?e.jsx(ue,{mt:50,children:e.jsx(ie,{order:3,c:"red",children:"No Applications Found"})}):e.jsxs(e.Fragment,{children:[e.jsx(A,{hiddenFrom:"md",gap:"md",children:i?.map(s=>e.jsx(xe,{withBorder:!0,p:"md",children:e.jsxs(A,{gap:"xs",children:[e.jsxs(T,{justify:"space-between",children:[e.jsxs(r,{fw:600,size:"lg",children:[s.firstName," ",s.lastName]}),e.jsx(q,{size:36,variant:"outline",color:"red",onClick:()=>{U(s._id,`${typeof s.listingId=="object"&&s.listingId.jobTitle}`)},children:e.jsx(ee,{size:20})})]}),e.jsx(r,{size:"sm",c:"dimmed",children:typeof s.listingId=="object"&&s.listingId.jobTitle}),e.jsx(r,{size:"sm",children:s.email}),s.phone&&e.jsx(r,{size:"sm",children:s.phone}),e.jsxs(r,{size:"xs",c:"dimmed",children:["Submitted: ",s.createdAt&&new Date(s.createdAt).toLocaleString()]}),e.jsxs(T,{gap:"xs",mt:"xs",children:[e.jsx(de,{href:s.resumeUrl,target:"_blank",children:e.jsx(q,{variant:"light",size:36,children:e.jsx(he,{size:20})})}),e.jsx(b,{flex:1,value:u||s.status,onChange:P=>h(s._id,P),data:[{value:"pending",label:"Pending"},{value:"reviewed",label:"Reviewed"},{value:"rejected",label:"Rejected"}]})]})]})},s._id))}),e.jsx(ge,{visibleFrom:"md",children:e.jsx(a.ScrollContainer,{minWidth:900,children:e.jsxs(a,{verticalSpacing:"sm",maw:"100%",mx:"auto",children:[e.jsx(a.Thead,{children:e.jsxs(a.Tr,{children:[e.jsx(a.Th,{}),e.jsx(a.Th,{children:"Applicant"}),e.jsx(a.Th,{children:"Listing"}),e.jsx(a.Th,{children:"Phone"}),e.jsx(a.Th,{children:"Email"}),e.jsx(a.Th,{children:"Submitted"}),e.jsx(a.Th,{children:"Resume"}),e.jsx(a.Th,{children:"Status"}),e.jsx(a.Th,{children:"Actions"})]})}),e.jsx(a.Tbody,{children:i?.map(s=>e.jsxs(a.Tr,{children:[e.jsx(a.Td,{styles:{td:{borderLeft:"1px solid #eee",borderRight:"1px solid #eee"}},children:e.jsx(r,{fz:"sm",fw:"bold",c:"dimmed",ta:"center",children:i.indexOf(s)+1})}),e.jsx(a.Td,{children:e.jsxs(r,{fz:"sm",fw:500,children:[s.firstName," ",s.lastName]})}),e.jsx(a.Td,{children:e.jsx(r,{fz:"sm",fw:500,children:typeof s.listingId=="object"&&s.listingId.jobTitle})}),e.jsx(a.Td,{children:e.jsx(r,{fz:"sm",fw:500,children:s.phone})}),e.jsx(a.Td,{children:e.jsx(r,{fz:"sm",children:s.email})}),e.jsx(a.Td,{children:s.createdAt&&new Date(s.createdAt).toLocaleString()}),e.jsx(a.Td,{children:e.jsx(de,{href:s.resumeUrl,target:"_blank",children:e.jsx(he,{size:30})})}),e.jsx(a.Td,{children:e.jsx(b,{px:5,value:u||s.status,onChange:P=>h(s._id,P),data:[{value:"pending",label:"Pending"},{value:"reviewed",label:"Reviewed"},{value:"rejected",label:"Rejected"}]})}),e.jsx(a.Td,{styles:{td:{borderRight:"1px solid #eee"}},children:e.jsx(T,{gap:"xs",children:e.jsx(q,{size:30,variant:"outline",color:"red",onClick:()=>{U(s._id,`${typeof s.listingId=="object"&&s.listingId.jobTitle}`)},children:e.jsx(ee,{size:25,stroke:1.5})})})})]},s._id))})]})})})]})]}),e.jsx(as,{opened:E,onClose:W,applicationId:B?.id||"",applicationTitle:B?.title||"",handleDelete:O})]})},is=({opened:i,onClose:d,handleDelete:x,listingId:o,listingTitle:n})=>{const[g,p]=c.useState(!1);return e.jsxs(le,{opened:i,onClose:d,title:"Delete Listing",centered:!0,children:[e.jsxs(r,{children:["Are you sure you want to delete the",e.jsxs("span",{style:{fontWeight:"bold"},children:[" ",n," "]}),"listing?"]}),e.jsxs(T,{mt:20,justify:"flex-end",gap:"sm",children:[e.jsx(K,{variant:"outline",onClick:d,children:"Cancel"}),e.jsx(K,{color:"red",onClick:()=>{d(),x(o)},loading:g,children:"Delete"})]})]})},ns=({opened:i,onClose:d,listing:x,setListings:o})=>{const[n,g]=c.useState(!1),{register:p,handleSubmit:z,reset:f,formState:{errors:j,isValid:y,isDirty:F},control:m}=ze({mode:"all",resolver:Le(Oe)});c.useEffect(()=>{if(i&&x){const l=Ee(x);f(l)}},[i]);const L=Ce({control:m,name:"location.region"}),C=c.useMemo(()=>L?De(L).map(l=>({value:l,label:l})):[],[L]),_=async l=>{try{g(!0);const h=await $.put(`/api/listings/${x?._id}`,{...l,expiresAt:l.expiresAt?new Date(l.expiresAt).toISOString():null});o(u=>u.map(v=>v._id===h.data._id?h.data:v)),N.show({title:"Success",message:"Listing updated successfully!",color:"green"}),d()}catch(h){N.show({title:"Error",message:`Update failed! ${h?.response?.data?.message||h.message}`,color:"red"})}finally{g(!1)}};return e.jsx(le,{opened:i,onClose:d,title:"Delete application",centered:!0,size:"xl",zIndex:100,children:e.jsxs(A,{gap:"md",p:"md",children:[e.jsx(ke,{justify:"space-between",align:"center",children:e.jsx(ie,{order:2,children:"Edit Listing"})}),e.jsx("form",{onSubmit:z(_),children:e.jsxs(A,{gap:"md",children:[e.jsx(Q,{legend:"Job Info",children:e.jsxs(A,{gap:"sm",children:[e.jsx(k,{label:"Company Name",required:!0,...p("companyName"),error:j.companyName?.message}),e.jsx(k,{label:"Job Title",required:!0,...p("jobTitle"),error:j.jobTitle?.message}),e.jsx(se,{label:"Job Description",required:!0,minRows:4,...p("jobDescription"),error:j.jobDescription?.message}),e.jsx(M,{name:"requirements",control:m,render:({field:l})=>e.jsx(se,{label:"Requirements",placeholder:"Add one requirement per line",minRows:3,value:(l.value||[]).join(`
`),onChange:h=>{const u=h.currentTarget.value.split(`
`).map(v=>v.trim()).filter(Boolean);l.onChange(u)},error:j.requirements?.message})}),e.jsx(M,{name:"advantages",control:m,render:({field:l})=>e.jsx(se,{label:"Nice to Have",placeholder:"Add one advantage per line",minRows:3,value:(l.value||[]).join(`
`),onChange:h=>{const u=h.currentTarget.value.split(`
`).map(v=>v.trim()).filter(Boolean);l.onChange(u)},error:j.advantages?.message})})]})}),e.jsx(Q,{legend:"Application",children:e.jsxs(A,{gap:"sm",children:[e.jsx(M,{name:"apply.method",control:m,render:({field:l})=>e.jsx(b,{label:"Application Method",required:!0,data:[{value:"email",label:"Email"},{value:"link",label:"External Link"}],...l,error:j.apply?.method?.message})}),e.jsx(k,{label:"Application Contact / URL",required:!0,...p("apply.contact"),error:j.apply?.contact?.message})]})}),e.jsx(Q,{legend:"Location",children:e.jsxs(A,{gap:"sm",children:[e.jsx(M,{name:"location.region",control:m,render:({field:l})=>e.jsx(b,{label:"Region",required:!0,searchable:!0,data:Fe.map(h=>({value:h,label:h})),...l,error:j.location?.region?.message})}),e.jsx(M,{name:"location.city",control:m,render:({field:l})=>e.jsx(b,{label:"City",required:!0,searchable:!0,disabled:!L,data:C,...l,error:j.location?.city?.message})})]})}),e.jsx(Q,{legend:"Job Details",children:e.jsxs(A,{gap:"sm",children:[e.jsx(M,{name:"workArrangement",control:m,render:({field:l})=>e.jsx(b,{label:"Work Arrangement",required:!0,searchable:!0,data:Ie.map(h=>({value:h,label:h})),...l,error:j.workArrangement?.message})}),e.jsx(M,{name:"industry",control:m,render:({field:l})=>e.jsx(b,{label:"Industry",required:!0,searchable:!0,data:ae.map(h=>({value:h,label:h})),...l,error:j.industry?.message})}),e.jsx(M,{name:"isActive",control:m,render:({field:l})=>e.jsx(Me,{label:"Listing is active",checked:l.value,onChange:h=>l.onChange(h.currentTarget.checked)})}),e.jsx(k,{label:"Expiration Date",type:"date",...p("expiresAt"),error:j.expiresAt?.message})]})}),e.jsx(T,{justify:"space-between",mt:"md",children:e.jsx(K,{type:"submit",variant:"filled",color:"green",leftSection:e.jsx(Je,{size:16}),disabled:!y||!F,loading:n,children:"Save Changes"})})]})})]})})},rs=({listings:i,handleDelete:d,searchText:x,setSearchText:o,industry:n,setIndustry:g,sortOption:p,setSortOption:z,activeFilter:f,setActiveFilter:j,page:y,setPage:F,setListings:m})=>{const[L,{open:C,close:_}]=te(!1),[l,h]=c.useState(null),[u,{open:v,close:O}]=te(!1),[E,I]=c.useState(),W=(t,U)=>{h({id:t,title:U}),C()},B=t=>{I(t),v()};return e.jsxs(e.Fragment,{children:[e.jsxs(A,{children:[e.jsxs(A,{gap:"md",hiddenFrom:"md",children:[e.jsx(k,{label:"Search listings",placeholder:"Search listings",value:x,onChange:t=>o(t.target.value)}),e.jsx(b,{label:"Sort by",placeholder:"Select sort option",value:p,onChange:t=>{z(t)},data:[{value:"all",label:"All Listings"},{value:"date-created-new",label:"Newest First"},{value:"date-created-old",label:"Oldest First"},{value:"favorites-most",label:"Most Favorited"},{value:"favorites-least",label:"Least Favorited"},{value:"title-asc",label:"Title A-Z"},{value:"title-desc",label:"Title Z-A"}]}),e.jsx(b,{label:"Filter by status",placeholder:"Select active filter",value:f,onChange:t=>{j(t)},data:[{value:"all",label:"All Listings"},{value:"active",label:"Active"},{value:"inactive",label:"Inactive"}]}),e.jsx(b,{label:"Filter by industry",placeholder:"Select industry",value:n,onChange:t=>{g(t)},data:[{value:"all",label:"All Industries"},...ae]})]}),e.jsxs(T,{justify:"center",visibleFrom:"md",children:[e.jsx(k,{label:"Search listings",placeholder:"Search listings",value:x,onChange:t=>o(t.target.value)}),e.jsx(b,{label:"Sort by",placeholder:"Select sort option",value:p,onChange:t=>{z(t)},data:[{value:"all",label:"All Listings"},{value:"date-created-new",label:"Newest First"},{value:"date-created-old",label:"Oldest First"},{value:"favorites-most",label:"Most Favorited"},{value:"favorites-least",label:"Least Favorited"},{value:"title-asc",label:"Title A-Z"},{value:"title-desc",label:"Title Z-A"}]}),e.jsx(b,{label:"Filter by status",placeholder:"Select active filter",value:f,onChange:t=>{j(t)},data:[{value:"all",label:"All Listings"},{value:"active",label:"Active"},{value:"inactive",label:"Inactive"}]}),e.jsx(b,{label:"Filter by industry",placeholder:"Select industry",value:n,onChange:t=>{g(t)},data:[{value:"all",label:"All Industries"},...ae]})]}),e.jsx(A,{hiddenFrom:"md",gap:"md",children:i?.map(t=>e.jsx(xe,{withBorder:!0,p:"md",children:e.jsxs(A,{gap:"xs",children:[e.jsxs(T,{justify:"space-between",align:"start",children:[e.jsxs("div",{children:[e.jsx(r,{fw:600,size:"lg",children:t.jobTitle}),e.jsx(r,{size:"sm",c:"dimmed",children:t.industry})]}),t.isActive?e.jsx(Y,{size:20,color:"green"}):e.jsx(Y,{size:20,color:"red"})]}),e.jsxs(T,{gap:"xs",children:[e.jsxs(r,{size:"xs",c:"dimmed",children:["Created: ",t.createdAt&&new Date(t.createdAt).toLocaleDateString()]}),e.jsx(r,{size:"xs",c:"dimmed",children:"â€¢"}),e.jsxs(r,{size:"xs",c:"dimmed",children:[t.likes?.length||0," favorites"]})]}),t.expiresAt&&e.jsxs(r,{size:"xs",c:"dimmed",children:["Expires: ",t.expiresAt]}),e.jsxs(T,{gap:"xs",mt:"xs",children:[e.jsx(q,{size:36,variant:"outline",color:"yellow",onClick:()=>B(t),children:e.jsx(ce,{size:20})}),e.jsx(q,{size:36,variant:"outline",color:"red",onClick:()=>W(t._id,t.jobTitle),children:e.jsx(ee,{size:20})})]})]})},t._id))}),e.jsx(ge,{visibleFrom:"md",children:e.jsx(a.ScrollContainer,{minWidth:800,children:e.jsxs(a,{verticalSpacing:"sm",maw:"100%",mx:"auto",children:[e.jsx(a.Thead,{children:e.jsxs(a.Tr,{children:[e.jsx(a.Th,{}),e.jsx(a.Th,{children:"Job Title"}),e.jsx(a.Th,{children:"Industry"}),e.jsx(a.Th,{children:"Created At"}),e.jsx(a.Th,{children:"Expires At"}),e.jsx(a.Th,{children:"Active"}),e.jsx(a.Th,{children:"Favorites"}),e.jsx(a.Th,{children:"Edit"}),e.jsx(a.Th,{children:"Delete"})]})}),e.jsx(a.Tbody,{children:i?.map(t=>e.jsxs(a.Tr,{children:[e.jsx(a.Td,{styles:{td:{borderLeft:"1px solid #eee",borderRight:"1px solid #eee"}},children:e.jsx(r,{fz:"sm",fw:"bold",c:"dimmed",ta:"center",children:i.indexOf(t)+1})}),e.jsx(a.Td,{children:e.jsx(r,{fz:"sm",fw:500,children:t.jobTitle})}),e.jsx(a.Td,{children:e.jsx(r,{fz:"sm",fw:500,children:t.industry})}),e.jsx(a.Td,{children:t.createdAt&&new Date(t.createdAt).toLocaleString()}),e.jsx(a.Td,{children:e.jsx(r,{fz:"sm",children:t.expiresAt})}),e.jsx(a.Td,{children:t.isActive===!0?e.jsx(Y,{size:16,color:"green"}):e.jsx(Y,{size:16,color:"red"})}),e.jsx(a.Td,{children:e.jsx(r,{fz:"sm",children:t.likes?.length})}),e.jsx(a.Td,{children:e.jsx(q,{size:30,variant:"outline",color:"yellow",onClick:()=>B(t),children:e.jsx(ce,{size:25,stroke:1.5})})}),e.jsx(a.Td,{styles:{td:{borderRight:"1px solid #eee"}},children:e.jsx(q,{size:30,variant:"outline",color:"red",onClick:()=>W(t._id,t.jobTitle),children:e.jsx(ee,{size:25,stroke:1.5})})})]},t._id))})]})})})]}),e.jsx(ns,{opened:u,onClose:O,listing:E,setListings:m}),e.jsx(is,{opened:L,onClose:_,listingId:l?.id||"",listingTitle:l?.title||"",handleDelete:d})]})},ds=({dashboardMetrics:i})=>e.jsx(Be,{cols:{base:1,xs:2,sm:3,md:5},spacing:"md",children:e.jsxs(e.Fragment,{children:[e.jsxs(V,{shadow:"sm",p:"md",radius:"md",withBorder:!0,className:oe.cardGradientSubtle,children:[e.jsxs(T,{justify:"space-between",mb:"xs",children:[e.jsx(r,{size:"xs",c:"dimmed",fw:700,tt:"uppercase",children:"Total Applications"}),e.jsx(X,{color:"rocketOrange",variant:"light",size:"lg",radius:"md",children:e.jsx(Pe,{size:20})})]}),e.jsx(r,{size:"xl",fw:700,children:i?.metrics?.totalApplications||0})]}),e.jsxs(V,{shadow:"sm",p:"md",radius:"md",withBorder:!0,className:oe.cardGradientRed,children:[e.jsxs(T,{justify:"space-between",mb:"xs",children:[e.jsx(r,{size:"xs",c:"dimmed",fw:700,tt:"uppercase",children:"Total Listings"}),e.jsx(X,{color:"rocketRed",variant:"light",size:"lg",radius:"md",children:e.jsx(qe,{size:20})})]}),e.jsx(r,{size:"xl",fw:700,children:i?.metrics?.totalListings||0})]}),e.jsxs(V,{shadow:"sm",p:"md",radius:"md",withBorder:!0,children:[e.jsxs(T,{justify:"space-between",mb:"xs",children:[e.jsx(r,{size:"xs",c:"dimmed",fw:700,tt:"uppercase",children:"Pending"}),e.jsx(X,{color:"yellow",variant:"light",size:"lg",radius:"md",children:e.jsx(Ze,{size:20})})]}),e.jsx(r,{size:"xl",fw:700,children:i?.metrics?.pendingApplications||0})]}),e.jsxs(V,{shadow:"sm",p:"md",radius:"md",withBorder:!0,children:[e.jsxs(T,{justify:"space-between",mb:"xs",children:[e.jsx(r,{size:"xs",c:"dimmed",fw:700,tt:"uppercase",children:"Reviewed"}),e.jsx(X,{color:"green",variant:"light",size:"lg",radius:"md",children:e.jsx(We,{size:20})})]}),e.jsx(r,{size:"xl",fw:700,children:i?.metrics?.reviewedApplications||0})]}),e.jsxs(V,{shadow:"sm",p:"md",radius:"md",withBorder:!0,children:[e.jsxs(T,{justify:"space-between",mb:"xs",children:[e.jsx(r,{size:"xs",c:"dimmed",fw:700,tt:"uppercase",children:"Rejected"}),e.jsx(X,{color:"red",variant:"light",size:"lg",radius:"md",children:e.jsx(Xe,{size:20})})]}),e.jsx(r,{size:"xl",fw:700,children:i?.metrics?.rejectedApplications||0})]})]})}),os=()=>{const[i,d]=c.useState([]),[x,o]=c.useState(!1),[n,g]=c.useState(""),[p,z]=c.useState("all"),[f,j]=c.useState("all"),[y,F]=c.useState("date-created-new"),[m,L]=c.useState(1),C=async()=>{o(!0);try{const u=await Qe({searchWord:n||void 0,industry:p,sortOption:y,page:m,limit:20});d(u.listings)}catch(u){N.show({title:"Error",message:u.response?.data?.message||"Failed to load listings",color:"red"})}finally{o(!1)}},_=u=>i.filter(v=>v._id!==u);c.useEffect(()=>{C()},[n,y,p,m]);const l=i.filter(u=>{if(f==="all")return!0;if(f==="active")return u.isActive===!0;if(f==="inactive")return u.isActive===!1});return{listings:y?.startsWith("favorites")?y==="favorites-least"?l.sort((u,v)=>(u.likes?.length||0)-(v.likes?.length||0)):l.sort((u,v)=>(v.likes?.length||0)-(u.likes?.length||0)):l,setListings:d,isLoading:x,searchText:n,industry:p,activeFilter:f,sortOption:y,page:m,setIndustry:z,setSearchText:g,setActiveFilter:j,setSortOption:F,setPage:L,refetchListings:C,removeListingById:_}},cs=()=>{const[i,d]=c.useState([]),[x,o]=c.useState(!1),[n,g]=c.useState(""),[p,z]=c.useState("all"),[f,j]=c.useState("all"),[y,F]=c.useState(""),[m,L]=c.useState(""),[C,_]=c.useState("date-newest"),[l,h]=c.useState(1),[u,v]=c.useState(null),O=E=>i.filter(I=>I._id!==E);return c.useEffect(()=>{(async()=>{o(!0);try{const I=await Ye({searchText:n||void 0,status:p,listingId:f,dateFrom:y||void 0,dateTo:m||void 0,sortOption:C,page:l,limit:20});d(I.applications)}catch(I){N.show({title:"Error",message:I.response?.data?.message||"Failed to load applications",color:"red"})}finally{o(!1)}})()},[n,p,f,y,m,C,l]),{applications:i,isLoading:x,searchText:n,status:p,listingId:f,dateFrom:y,dateTo:m,sortOption:C,page:l,setSearchText:g,setStatus:z,setListingId:j,setDateFrom:F,setDateTo:L,setSortOption:_,setPage:h,newStatus:u,setNewStatus:v,setApplications:d,removeApplicationById:O}},hs=()=>{const[i,d]=c.useState(!1),[x,o]=c.useState(),n=async()=>{try{d(!0);const g=await je();o(g)}catch(g){N.show({title:"Error",message:g.response?.data?.message||g.message,color:"red"})}finally{d(!1)}};return c.useEffect(()=>{n()},[]),{dashboardMetrics:x,setDashboardMetrics:o,getDashboardMetrics:n}},ps=()=>{const[i,d]=c.useState(!1),{dashboardMetrics:x,setDashboardMetrics:o}=hs(),{listings:n,setListings:g,isLoading:p,searchText:z,setSearchText:f,industry:j,setIndustry:y,sortOption:F,setSortOption:m,activeFilter:L,setActiveFilter:C,page:_,setPage:l,removeListingById:h}=os(),{applications:u,searchText:v,setSearchText:O,status:E,setStatus:I,listingId:W,setListingId:B,dateFrom:t,setDateFrom:U,dateTo:s,setDateTo:P,sortOption:me,setSortOption:pe,page:ve,setPage:be,newStatus:fe,setNewStatus:we,setApplications:ne,removeApplicationById:ye}=cs(),Se=[{value:"all",label:"All Listings"},...n.map(D=>({value:D._id,label:D.jobTitle}))??[]],Te=async D=>{if(!D)return;const R=h(D);g(R);try{await ss(D),N.show({title:"Success",message:"Listing deleted successfully",color:"green"})}catch(S){N.show({title:"Error",message:S.response?.data?.message||"Failed to delete listing",color:"red"})}o(S=>S&&{...S,metrics:{...S.metrics,totalListings:R.length}})},Ae=async D=>{if(!D)return;const R=ye(D);ne(R);try{await ts(D),N.show({title:"Success",message:"Application deleted successfully",color:"green"})}catch(S){N.show({title:"Error",message:S.response?.data?.message||"Failed to delete application",color:"red"})}o(S=>S&&{...S,metrics:{...S.metrics,totalApplications:R.length,pendingApplications:R.filter(w=>w.status==="pending").length,reviewedApplications:R.filter(w=>w.status==="reviewed").length,rejectedApplications:R.filter(w=>w.status==="rejected").length}})},re=async(D,R)=>{if(!R)return;const S=R;try{await es(D,S);const w=await je();o(w)}catch(w){N.show({title:"Error",message:w.response?.data?.message||"Failed to update application status",color:"red"})}ne(w=>w&&w.map(J=>J._id===D?{...J,status:S}:J)),o(w=>{if(!w)return w;const J={pendingApplications:u.filter(H=>H.status==="pending").length,reviewedApplications:u.filter(H=>H.status==="reviewed").length,rejectedApplications:u.filter(H=>H.status==="rejected").length};return{...w,metrics:{...w.metrics,updatedMetrics:J}}})};return e.jsxs(e.Fragment,{children:[e.jsx(Re,{title:"Dashboard | JobRocket",description:"Manage your listings and applications.",keywords:"analytics, dashboard, job applications, manage job applications, manage job listings"}),i?e.jsx(ue,{py:50,h:"calc(100vh - 200px)",children:e.jsx(_e,{size:"xl",variant:"oval"})}):e.jsx(Ne,{size:"xl",py:"xl",w:{base:"100%",sm:"95%",md:"85%"},children:e.jsxs(A,{gap:"xl",children:[e.jsxs("div",{children:[e.jsx(ie,{order:1,mb:"xs",children:"Dashboard"}),e.jsx(r,{c:"dimmed",size:"lg",children:"Welcome back! Here's your overview"})]}),e.jsx(ds,{dashboardMetrics:x}),e.jsxs(Z,{color:"rocketOrange",variant:"outline",defaultValue:"applications",children:[e.jsxs(Z.List,{mb:20,justify:"center",fw:600,children:[e.jsx(Z.Tab,{value:"applications",fz:{base:"lg",md:30},children:"Applications"}),e.jsx(Z.Tab,{value:"listings",fz:{base:"lg",md:30},children:"Listings"})]}),e.jsx(Z.Panel,{value:"applications",children:e.jsx(ls,{dashApplications:u,listingOptions:Se,onStatusChange:re,searchText:v,setSearchText:O,status:E,setStatus:I,listingId:W,setListingId:B,dateFrom:t,setDateFrom:U,dateTo:s,setDateTo:P,sortOption:me,setSortOption:pe,page:ve,setPage:be,updateApplicationStatus:re,newStatus:fe,setNewStatus:we,handleApplicationDelete:Ae})}),e.jsx(Z.Panel,{value:"listings",children:e.jsx(rs,{listings:n,isLoading:p,searchText:z,setSearchText:f,sortOption:F,setSortOption:m,activeFilter:L,setActiveFilter:C,page:_,setPage:l,industry:j,setIndustry:y,handleDelete:Te,setListings:g})})]})]})})]})};export{ps as Dashboard};
