import{aa as e,N as J,ac as N,H as V,ad as $,r as F,u as _,K as A,i as z,n as H,a as B,ae as O,q as d,af as L,ag as M,j as s,t as W,F as u,e as K,m as g,d as Q,ah as G,ai as X,aj as Y,T as b,B as E}from"./index-VHpNQsUs.js";import{D as Z}from"./DeleteUserModal-CVnS5ieW.js";import{a as x}from"./getCleanedListingData-Cbsw5E8V.js";const ee=e.object({phone:e.string().required().pattern(/^0(?:5[0-9]|[2-4689])(?:-?\d{3}(?:-?\d{4}))$/).messages({"string.empty":"Phone number is required","string.pattern.base":"Phone must be a valid Israeli phone number."}),profileType:e.string().valid("jobseeker","business").required().messages({"any.only":"Profile type must be either jobseeker or business","string.empty":"Profile type is required","any.required":"Profile type is required"}),jobseekerProfile:e.when("profileType",{is:"jobseeker",then:e.object({firstName:e.string().min(2).max(256).required().messages({"string.min":"First name is too short","string.empty":"First name is required","any.required":"First name is required"}),lastName:e.string().min(2).max(256).required().messages({"string.min":"Last name is too short","string.empty":"Last name is required","any.required":"Last name is required"}),highestEducation:e.string().valid("High School","Associate Degree","Bachelor's Degree","Master's Degree","Doctorate","Other").required().messages({"any.only":"Please select a valid education level","string.empty":"Education level is required","any.required":"Education level is required"}),preferredWorkArrangement:e.string().required().messages({"string.empty":"Preferred work arrangement is required","any.required":"Preferred work arrangement is required"}),linkedinPage:e.string().uri().allow("").optional().messages({"string.uri":"Please enter a valid LinkedIn URL"}),resume:e.string().max(1024).allow("").optional(),skills:e.array().items(e.string()).optional().default([]),description:e.string().max(2e3).allow("").optional().messages({"string.max":"Description cannot exceed 2000 characters"})}).required(),otherwise:e.forbidden()}),businessProfile:e.when("profileType",{is:"business",then:e.object({companyName:e.string().min(2).max(256).required().messages({"string.min":"Business name is too short","string.empty":"Business name is required","any.required":"Business name is required"}),location:e.object({country:e.string().min(2).max(256).required().messages({"string.min":"Country is too short","string.empty":"Country is required","any.required":"Country is required"}),city:e.string().min(2).max(256).required().messages({"string.min":"City is too short","string.empty":"City is required","any.required":"City is required"})}).required(),logo:e.object({url:e.string().uri().allow("").optional().messages({"string.uri":"Please enter a valid logo URL"}),alt:e.string().max(256).allow("").optional()}).optional(),industry:e.string().required().messages({"string.empty":"Industry is required","any.required":"Industry is required"}),numberOfEmployees:e.string().valid("1-10","11-50","51-200","201-500","501-1000","1000+").required().messages({"any.only":"Please select a valid employee range","string.empty":"Number of employees is required","any.required":"Number of employees is required"}),website:e.string().uri().max(512).allow("").optional().messages({"string.uri":"Please enter a valid website URL"}),contactEmail:e.string().email({tlds:{allow:!1}}).allow("").optional().messages({"string.email":"Please enter a valid contact email"}),socialMedia:e.object({linkedin:e.string().uri().max(512).allow("").optional().messages({"string.uri":"Please enter a valid LinkedIn URL"}),twitter:e.string().uri().max(512).allow("").optional().messages({"string.uri":"Please enter a valid Twitter URL"}),facebook:e.string().uri().max(512).allow("").optional().messages({"string.uri":"Please enter a valid Facebook URL"})}).optional(),description:e.string().max(2e3).allow("").optional().messages({"string.max":"Description cannot exceed 2000 characters"})}).required(),otherwise:e.forbidden()})}),se=()=>{const j=J(),{id:q}=N(),a=V("(max-width: 700px)"),t=$(),[w,p]=F.useState(!1),[c,{open:P,close:k}]=_(!1),n=A(r=>r.userSlice.isAdminView),U=A(r=>r.userSlice.user),S=A(r=>r.userSlice.allUsers)?.find(r=>r._id===q),i=n?S:U,{register:v,handleSubmit:y,reset:l,control:f,formState:{errors:D,isValid:h,isDirty:R},trigger:I}=z({mode:"all",resolver:H(ee),defaultValues:i?x(i):{}});return F.useEffect(()=>{if(i){const r=x(i);l(r)}},[l,i]),{isSubmitting:w,isAdminView:n,userData:i,register:v,handleSubmit:y,onSubmit:async r=>{const o={phone:r.phone,profileType:r.profileType};r.profileType==="jobseeker"&&(o.jobseekerProfile=r.jobseekerProfile),r.profileType==="business"&&(o.businessProfile=r.businessProfile);try{const m=await B.put(`/api/users/${i?._id}`,o);if(m.status===200){const T=m.data;n||t(L(T)),n&&t(M(T)),l(x(T)),d.show({title:"Success",message:"Profile Updated Successfully!",color:"green"})}}catch(m){d.show({title:"Error",message:`Update Failed! ${m?.response?.data||m.message}`,color:"red"})}},trigger:I,errors:D,isDirty:R,isValid:h,updateBusinessStatus:async()=>{try{const r=await B.patch(`/api/users/${i?._id}`);if(r.status===200){const o=r.data;p(!0),setTimeout(()=>{n||t(L(o)),n&&t(M(o)),l(x(o)),d.show({title:"Success",message:"Account Status Updated",color:"green"}),p(!1)},1e3)}}catch(r){d.show({title:"Error",message:r.response.data.message,color:"red"})}},isMobile:a,opened:c,open:P,close:k,deleteUser:async()=>{try{(await B.delete(`/api/users/${i?._id}`)).status===200&&(n?j("/admin"):t(O()),d.show({title:"Warning",message:"Account Deleted.",color:"orange"}))}catch(r){d.show({title:"Error",message:r.response.data.message,color:"red"})}},control:f}};function le(){const{isSubmitting:j,isAdminView:q,userData:a,register:t,handleSubmit:w,onSubmit:p,errors:c,isDirty:P,isValid:k,updateBusinessStatus:n,isMobile:U,opened:C,open:S,close:i,deleteUser:v,control:y}=se(),l=a?.profileType==="jobseeker",f=a?.profileType==="business",D=a?.isAdmin?"Admin":f?"Business":"Jobseeker";return s.jsxs(s.Fragment,{children:[s.jsx(W,{title:"My Profile | JobRocket",description:"Manage your JobRocket profile and job search preferences",keywords:"job seeker profile, manage account, profile settings"}),s.jsxs(u,{mt:20,direction:"column",align:"center",gap:20,children:[s.jsx(K,{children:"Edit Profile"}),s.jsx(u,{my:10,justify:"center",direction:"column",w:U?"90%":"50%",children:s.jsx("form",{onSubmit:w(p),children:s.jsxs(u,{gap:10,direction:"column",m:"auto",children:[s.jsx(g,{legend:"Contact",children:s.jsx(Q,{rightSection:s.jsx(G,{}),label:"Phone",required:!0,...t("phone",{onChange:h=>{h.target.value=h.target.value.replace(/[^\d-]/g,"")}}),error:c.phone?.message})}),l&&s.jsx(g,{legend:"Jobseeker Details",children:s.jsx(X,{register:t,errors:c,control:y})}),f&&s.jsx(g,{legend:"Business Details",children:s.jsx(Y,{register:t,errors:c,control:y})}),s.jsx(g,{legend:"Change Account Type",children:s.jsxs(u,{align:"center",direction:"column",justify:"center",gap:10,children:[s.jsxs(b,{children:["Account Type: ",s.jsxs("strong",{children:[D," User"]})]}),!a?.isAdmin&&s.jsx(E,{size:"xs",loading:j,onClick:()=>n(),children:s.jsx(b,{fz:"sm",children:"Toggle Jobseeker / Business"})}),a?.isAdmin&&s.jsx(b,{size:"xs",c:"red",children:"Cannot change or delete an admin user"})]})}),a?.isAdmin===!1&&q===!1&&s.jsx(g,{legend:"Delete Account",children:s.jsxs(u,{align:"center",direction:"column",gap:5,children:[s.jsx(b,{fw:"bold",c:"red",children:"All data will be lost and you will be logged out."}),s.jsx(E,{color:"red",onClick:S,children:"Delete Account"})]})}),s.jsx(u,{direction:"column",gap:5,w:"50%",mx:"auto",children:s.jsx(E,{disabled:!k||!P,type:"submit",children:"Update Info"})})]})})})]}),s.jsx(Z,{opened:C,close:i,deleteUser:v})]})}export{le as EditProfile};
