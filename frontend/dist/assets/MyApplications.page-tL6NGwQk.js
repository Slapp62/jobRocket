import{r as n,i as U,j as e,M as F,S as f,d as j,x as B,o as _,B as z,n as P,a as k,q as y,y as J,h as p,s as V,T as a,e as E,G,z as I,D as N,E as g,g as R,u as D,t as $,C as O,L as H,F as K,f as Q}from"./index-VHpNQsUs.js";const W=({opened:l,onClose:c,application:s,onSuccess:i})=>{const[d,h]=n.useState(!1),{reset:x,register:m,handleSubmit:b,formState:{errors:o,isValid:w}}=U({mode:"all",resolver:P(J),shouldUnregister:!1,criteriaMode:"all"}),[v,A]=n.useState(null);n.useEffect(()=>{s&&l&&x({firstName:s.firstName,lastName:s.lastName,email:s.email,phone:s.phone||"",resumeUrl:s.resumeUrl,message:s.message||""})},[s,l,x]);const S=async L=>{if(s)try{h(!0),await k.put(`/api/applications/${s._id}`,L),y.show({title:"Success",message:"Application updated successfully",color:"green"}),c(),i&&i()}catch(u){console.error(u),y.show({title:"Error",message:u.response?.data?.message||"Failed to update application",color:"red"})}finally{h(!1)}};return s?e.jsx(F,{opened:l,onClose:c,title:"Edit Application",size:"lg",zIndex:1e3,children:e.jsx("form",{onSubmit:b(S),children:e.jsxs(f,{p:"lg",children:[e.jsx(j,{label:"First Name",required:!0,...m("firstName"),error:o.firstName?.message}),e.jsx(j,{label:"Last Name",required:!0,...m("lastName"),error:o.lastName?.message}),e.jsx(j,{label:"Email",required:!0,...m("email"),error:o.email?.message}),e.jsx(j,{label:"Phone",...m("phone"),error:o.phone?.message}),e.jsx(B,{label:"Resume/CV",accept:"application/pdf",required:!0,onChange:A,error:o.resumeUrl?.message}),e.jsx(_,{label:"Message",...m("message"),error:o.message?.message}),e.jsx(z,{type:"submit",mx:"auto",w:200,disabled:!w,loading:d,children:"Update Application"})]})})}):null},X=({opened:l,onClose:c,listing:s})=>e.jsx(F,{opened:l,onClose:c,title:"Listing Details",size:"lg",centered:!0,zIndex:1e3,children:s&&e.jsxs(f,{gap:"md",h:"100%",children:[e.jsxs(p,{p:"md",className:V.cardGradientSubtle,style:{borderRadius:"8px",marginTop:"-16px",marginLeft:"-16px",marginRight:"-16px"},children:[e.jsx(a,{fw:700,size:"lg",c:"dimmed",mb:5,children:s.companyName}),e.jsx(E,{order:2,mb:"xs",children:s.jobTitle}),e.jsxs(G,{gap:"xs",children:[e.jsx(I,{variant:"filled",color:"rocketOrange",children:s.workArrangement}),e.jsx(I,{variant:"filled",color:"rocketRed",children:s.industry})]})]}),e.jsx(N,{}),s.location&&e.jsxs(p,{children:[e.jsx(a,{fw:600,size:"sm",mb:5,children:"Location"}),e.jsxs(a,{size:"sm",children:[s.location.city,", ",s.location.region]})]}),e.jsxs(p,{children:[e.jsx(a,{fw:600,size:"sm",mb:5,children:"Job Description"}),e.jsx(a,{size:"sm",style:{whiteSpace:"pre-wrap"},children:s.jobDescription})]}),s.requirements&&s.requirements.length>0&&e.jsxs(p,{children:[e.jsx(a,{fw:600,size:"sm",mb:5,children:"Requirements"}),e.jsx(g,{size:"sm",spacing:"xs",children:s.requirements.map((i,d)=>e.jsx(g.Item,{children:i},d))})]}),s.advantages&&s.advantages.length>0&&e.jsxs(p,{children:[e.jsx(a,{fw:600,size:"sm",mb:5,children:"Advantages"}),e.jsx(g,{size:"sm",spacing:"xs",children:s.advantages.map((i,d)=>e.jsx(g.Item,{children:i},d))})]}),e.jsx(N,{}),s.apply&&e.jsxs(p,{children:[e.jsx(a,{fw:600,size:"sm",mb:5,children:"How to Apply"}),e.jsxs(a,{size:"sm",mb:5,children:["Apply via ",s.apply.method==="email"?"email":"external link",":"]}),s.apply.method==="email"?e.jsx(R,{href:`mailto:${s.apply.contact}`,target:"_blank",children:s.apply.contact}):e.jsx(R,{href:s.apply.contact,target:"_blank",children:s.apply.contact})]}),s.createdAt&&e.jsxs(a,{size:"xs",c:"dimmed",ta:"center",children:["Posted on ",new Date(s.createdAt).toLocaleDateString()]})]})});function ee(){const[l,c]=n.useState(!1),[s,i]=n.useState([]),[d,h]=n.useState(!1),[x,{open:m,close:b}]=D(!1),[o,w]=n.useState(null),[v,{open:A,close:S}]=D(!1),[L,u]=n.useState(null);n.useEffect(()=>{(async()=>{c(!0);try{const r=await k.get("/api/applications/my-applications");r.data.length>0?i(r.data):h(!0)}catch(r){y.show({title:"Error",message:r.response?.data?.message||r.message,color:"red"})}finally{setTimeout(()=>{c(!1)},1e3)}})()},[]);const q=t=>{w(t),m()},M=t=>{u(t),A()},T=()=>{(async()=>{try{const r=localStorage.getItem("token")||sessionStorage.getItem("token"),C=await k.get("/api/applications/my-applications",{headers:{"x-auth-token":r}});i(C.data)}catch{y.show({title:"Error",message:"Failed to refresh applications",color:"red"})}})()};return e.jsxs(e.Fragment,{children:[e.jsx($,{title:"Job Applications | JobRocket",description:"Manage your job applications on JobRocket",keywords:"job applications, manage job applications, job listings"}),l?e.jsx(O,{py:50,h:"calc(100vh - 200px)",children:e.jsx(H,{size:"xl",variant:"oval"})}):e.jsxs(f,{w:"100%",gap:"md",children:[e.jsx(E,{ta:"center",order:2,my:15,c:"rocketRed.9",children:"Applications"}),d?e.jsx(a,{children:"No applications found"}):null,e.jsx(K,{w:"100%",gap:"md",wrap:"wrap",align:"stretch",justify:"center",children:s.map((t,r)=>e.jsx(Q,{withBorder:!0,p:"md",w:"250px",style:{display:"flex"},children:e.jsxs(f,{h:"100%",w:"100%",justify:"space-between",style:{flex:1},children:[typeof t.listingId=="object"&&e.jsx(E,{order:5,children:t.listingId.companyName}),typeof t.listingId=="object"&&e.jsx(a,{children:t.listingId.jobTitle}),e.jsx(I,{variant:"outline",c:t.status==="rejected"?"red":t.status==="pending"?"yellow":"green",children:t.status}),e.jsxs(a,{fz:"sm",c:"dimmed",children:["Submitted on ",new Date(t.createdAt).toLocaleDateString()]}),e.jsx(z,{variant:"outline",onClick:()=>q(t.listingId),children:"View Listing"}),e.jsx(z,{variant:"outline",onClick:()=>M(t),disabled:t.status!=="pending",children:"Edit Application"})]})},r))})]}),e.jsx(X,{opened:x,onClose:b,listing:o}),e.jsx(W,{opened:v,onClose:S,application:L,onSuccess:T})]})}export{ee as MyApplications};
