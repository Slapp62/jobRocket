import{ao as e,ap as H,R as G,O as Q,aq as Z,a7 as K,ar as X,r as w,s as Y,a9 as I,x as ee,y as se,a2 as re,o as S,as as ie,N as c,at as N,au as V,j as r,Z as te,F as b,H as ae,I as q,v as ne,av as oe,aw as le,ax as ue,T as $,p as M}from"./index-b55nogiJ.js";import{D as de}from"./DeleteUserModal-CIa1nb_k.js";import{a as U}from"./getCleanedListingData-KxhxgDA4.js";const ce=e.object({phone:e.string().required().pattern(/^0(?:5[0-9]|[2-4689])(?:-?\d{3}(?:-?\d{4}))$/).messages({"string.empty":"Phone number is required","string.pattern.base":"Phone must be a valid Israeli phone number."}),profileType:e.string().valid("jobseeker","business").required().messages({"any.only":"Profile type must be either jobseeker or business","string.empty":"Profile type is required","any.required":"Profile type is required"}),jobseekerProfile:e.when("profileType",{is:"jobseeker",then:e.object({firstName:e.string().min(2).max(256).required().messages({"string.min":"First name is too short","string.empty":"First name is required","any.required":"First name is required"}),lastName:e.string().min(2).max(256).required().messages({"string.min":"Last name is too short","string.empty":"Last name is required","any.required":"Last name is required"}),highestEducation:e.string().valid("High School","Associate Degree","Bachelor's Degree","Master's Degree","Doctorate","Other").required().messages({"any.only":"Please select a valid education level","string.empty":"Education level is required","any.required":"Education level is required"}),preferredWorkArrangement:e.string().required().messages({"string.empty":"Preferred work arrangement is required","any.required":"Preferred work arrangement is required"}),linkedinPage:e.string().uri().allow("").optional().messages({"string.uri":"Please enter a valid LinkedIn URL"}),resume:e.string().max(1024).allow("").optional().messages({"string.max":"Resume URL cannot exceed 1024 characters"}),skills:e.array().items(e.string().max(50).messages({"string.max":"Each skill must be 50 characters or less"})).max(25).optional().default([]).messages({"array.max":"Maximum 25 skills allowed"}),description:e.string().max(2e3).allow("").optional().messages({"string.max":"Description cannot exceed 2000 characters"})}).required(),otherwise:e.forbidden()}),businessProfile:e.when("profileType",{is:"business",then:e.object({companyName:e.string().min(2).max(256).required().messages({"string.min":"Business name is too short","string.empty":"Business name is required","any.required":"Business name is required"}),location:e.object({country:e.string().min(2).max(256).required().messages({"string.min":"Country is too short","string.empty":"Country is required","any.required":"Country is required"}),region:e.string().valid(...G).required().messages({"any.only":"Please select a valid region","string.empty":"Region is required","any.required":"Region is required"}),city:e.string().valid(...H).required().messages({"any.only":"Please select a valid city","string.empty":"City is required","any.required":"City is required"})}).required(),logo:e.object({url:e.string().uri().allow("").optional().messages({"string.uri":"Please enter a valid logo URL"}),alt:e.string().max(256).allow("").optional()}).optional(),numberOfEmployees:e.string().valid("1-10","11-50","51-200","201-500","501-1000","1000+").required().messages({"any.only":"Please select a valid employee range","string.empty":"Number of employees is required","any.required":"Number of employees is required"}),website:e.string().uri().max(512).allow("").optional().messages({"string.uri":"Please enter a valid website URL"}),contactEmail:e.string().email({tlds:{allow:!1}}).allow("").optional().messages({"string.email":"Please enter a valid contact email"}),socialMedia:e.object({linkedin:e.string().uri().max(512).allow("").optional().messages({"string.uri":"Please enter a valid LinkedIn URL"}),twitter:e.string().uri().max(512).allow("").optional().messages({"string.uri":"Please enter a valid Twitter URL"}),facebook:e.string().uri().max(512).allow("").optional().messages({"string.uri":"Please enter a valid Facebook URL"})}).optional(),description:e.string().max(2e3).allow("").optional().messages({"string.max":"Description cannot exceed 2000 characters"})}).required(),otherwise:e.forbidden()})}),me=()=>{const D=Q(),{id:E}=Z(),u=K("(max-width: 700px)"),n=X(),[R,m]=w.useState(!1),[x,P]=w.useState(!1),[T,{open:A,close:g}]=Y(!1),o=I(s=>s.userSlice.isAdminView),F=I(s=>s.userSlice.user),B=I(s=>s.userSlice.allUsers)?.find(s=>s._id===E),[p,f]=w.useState(null),[j,C]=w.useState(null),t=o?B:F,{register:L,handleSubmit:k,reset:y,control:v,formState:{errors:O,isValid:_,isDirty:W},trigger:z}=ee({mode:"all",resolver:se(ce),defaultValues:t?U(t):{}});return w.useEffect(()=>{if(t){const s=U(t);y(s)}},[y,t]),{isSubmitting:R,isDeleting:x,isAdminView:o,userData:t,register:L,handleSubmit:k,onSubmit:async s=>{if(j){c.show({title:"Validation Error",message:j,color:"red"});return}const i={phone:s.phone,profileType:s.profileType};s.profileType==="jobseeker"&&(i.jobseekerProfile=s.jobseekerProfile),s.profileType==="business"&&(i.businessProfile=s.businessProfile);try{m(!0);let d;if(p){const a=new FormData;a.append("phone",i.phone||""),a.append("profileType",i.profileType||""),i.jobseekerProfile&&Object.keys(i.jobseekerProfile).forEach(h=>{const l=i.jobseekerProfile[h];l!=null&&(Array.isArray(l)?a.append(`jobseekerProfile[${h}]`,JSON.stringify(l)):a.append(`jobseekerProfile[${h}]`,String(l)))}),i.businessProfile&&Object.keys(i.businessProfile).forEach(h=>{const l=i.businessProfile[h];l!=null&&a.append(`businessProfile[${h}]`,String(l))}),a.append("resume",p),d=await S.put(`/api/users/${t?._id}`,a)}else d=await S.put(`/api/users/${t?._id}`,i);if(d.status===200){const a=d.data;o||n(N(a)),o&&n(V(a)),y(U(a)),f(null),c.show({title:"Success",message:"Profile Updated Successfully!",color:"green"})}}catch(d){const a=d?.response?.data?.message||d?.response?.data||d.message||"An unexpected error occurred";c.show({title:"Error",message:a,color:"red"})}finally{m(!1)}},trigger:z,errors:O,isDirty:W,isValid:_,updateBusinessStatus:async()=>{try{m(!0);const s=await S.patch(`/api/users/${t?._id}`);if(s.status===200){const i=s.data;setTimeout(()=>{o||n(N(i)),o&&n(V(i)),y(U(i)),c.show({title:"Success",message:"Account Status Updated",color:"green"})},1e3)}}catch(s){c.show({title:"Error",message:s.response.data.message,color:"red"})}finally{m(!1)}},isMobile:u,opened:T,open:A,close:g,deleteUser:async()=>{try{P(!0),(await S.delete(`/api/users/${t?._id}`)).status===200&&(o?D("/admin"):n(ie()),c.show({title:"Warning",message:"Account Deleted.",color:"orange"}))}catch(s){c.show({title:"Error",message:s.response.data.message,color:"red"})}finally{P(!1)}},control:v,resumeFile:p,setResumeFile:f,resumeError:j,handleResumeChange:s=>{const i=re(s);C(i),f(i?null:s)}}};function je(){const{isSubmitting:D,isAdminView:E,userData:u,register:n,handleSubmit:R,onSubmit:m,errors:x,isDirty:P,isValid:T,updateBusinessStatus:A,isMobile:g,opened:o,open:F,close:J,deleteUser:B,control:p,resumeFile:f,setResumeFile:j,isDeleting:C,resumeError:t}=me(),L=u?.profileType==="jobseeker",k=u?.profileType==="business",y=u?.isAdmin?"Admin":k?"Business":"Jobseeker";return r.jsxs(r.Fragment,{children:[r.jsx(te,{title:"My Profile | JobRocket",description:"Manage your JobRocket profile and job search preferences",keywords:"job seeker profile, manage account, profile settings"}),r.jsxs(b,{mt:20,direction:"column",align:"center",gap:20,children:[r.jsx(ae,{children:"Edit Profile"}),r.jsx(b,{my:10,justify:"center",direction:"column",w:g?"90%":"50%",children:r.jsx("form",{onSubmit:R(m),children:r.jsxs(b,{gap:10,direction:"column",m:"auto",children:[r.jsx(q,{legend:"Contact",children:r.jsx(ne,{rightSection:r.jsx(oe,{}),label:"Phone",required:!0,...n("phone",{onChange:v=>{v.target.value=v.target.value.replace(/[^\d-]/g,"")}}),error:x.phone?.message})}),L&&r.jsx(q,{legend:"Jobseeker Details",children:r.jsx(le,{register:n,errors:x,control:p,resumeFile:f,setResumeFile:j,currentResumeUrl:u.jobseekerProfile?.resume,resumeError:t,setResumeError:void 0})}),k&&r.jsx(q,{legend:"Business Details",children:r.jsx(ue,{register:n,errors:x,control:p})}),r.jsxs(b,{direction:g?"column":"row",gap:10,children:[!u?.isAdmin&&r.jsx(q,{legend:"Change Account Type",w:g?"100%":"50%",children:r.jsxs(b,{direction:"column",h:"100%",justify:"space-between",children:[r.jsxs($,{children:["Account Type: ",r.jsxs("strong",{children:[y," User"]})]}),r.jsx(M,{onClick:()=>A(),variant:"outline",children:"Toggle Jobseeker / Business"})]})}),u?.isAdmin===!1&&E===!1&&r.jsx(q,{legend:"Delete Account",w:g?"100%":"50%",children:r.jsxs(b,{h:"100%",justify:"space-between",direction:"column",gap:5,children:[r.jsx($,{fw:"bold",c:"red",fz:"sm",children:"All data will be lost and you will be logged out."}),r.jsx(M,{color:"red",onClick:F,children:"Delete Account"})]})})]}),r.jsx(M,{disabled:!T||!P&&!f||!!t,type:"submit",loading:D,fullWidth:!0,size:"lg",mt:10,children:"Update Info"})]})})})]}),r.jsx(de,{opened:o,close:J,deleteUser:B,isDeleting:C})]})}export{je as EditProfile};
