import{r as l,i as B,j as e,M as F,S as b,d as f,x as _,o as U,B as N,n as P,a as E,q as w,y as J,h as x,s as V,T as a,e as I,G,z as R,D as k,E as y,g as v,u as D,t as $,C as O,L as H,F as K,f as Q}from"./index-CU6HyXET.js";const W=({opened:d,onClose:p,application:s,onSuccess:n})=>{const[m,u]=l.useState(!1),{reset:j,register:h,handleSubmit:A,formState:{errors:c,isValid:S}}=B({mode:"all",resolver:P(J),shouldUnregister:!1,criteriaMode:"all"}),[g,L]=l.useState(null);l.useEffect(()=>{s&&d&&j({firstName:s.firstName,lastName:s.lastName,email:s.email,phone:s.phone||"",message:s.message||""})},[s,d,j]);const z=async o=>{if(s)try{u(!0);const r=new FormData;r.append("firstName",o.firstName),r.append("lastName",o.lastName),r.append("email",o.email),o.phone&&r.append("phone",o.phone),o.message&&r.append("message",o.message),g&&r.append("resume",g),await E.put(`/api/applications/${s._id}`,r),w.show({title:"Success",message:"Application updated successfully",color:"green"}),p(),n&&n()}catch(r){console.error(r),w.show({title:"Error",message:r.response?.data?.message||"Failed to update application",color:"red"})}finally{u(!1)}};return s?e.jsx(F,{opened:d,onClose:p,title:"Edit Application",size:"lg",zIndex:1e3,children:e.jsx("form",{onSubmit:A(z),children:e.jsxs(b,{p:"lg",children:[e.jsx(f,{label:"First Name",required:!0,...h("firstName"),error:c.firstName?.message}),e.jsx(f,{label:"Last Name",required:!0,...h("lastName"),error:c.lastName?.message}),e.jsx(f,{label:"Email",required:!0,...h("email"),error:c.email?.message}),e.jsx(f,{label:"Phone",...h("phone"),error:c.phone?.message}),e.jsx(_,{label:"Resume/CV",accept:"application/pdf",required:!0,onChange:L,error:c.resumeUrl?.message}),e.jsx(U,{label:"Message",...h("message"),error:c.message?.message}),e.jsx(N,{type:"submit",mx:"auto",w:200,disabled:!S,loading:m,children:"Update Application"})]})})}):null},X=({opened:d,onClose:p,listing:s})=>e.jsx(F,{opened:d,onClose:p,title:"Listing Details",size:"lg",centered:!0,zIndex:1e3,children:s&&e.jsxs(b,{gap:"md",h:"100%",children:[e.jsxs(x,{p:"md",className:V.cardGradientSubtle,style:{borderRadius:"8px",marginTop:"-16px",marginLeft:"-16px",marginRight:"-16px"},children:[e.jsx(a,{fw:700,size:"lg",c:"dimmed",mb:5,children:s.companyName}),e.jsx(I,{order:2,mb:"xs",children:s.jobTitle}),e.jsx(G,{gap:"xs",children:e.jsx(R,{variant:"filled",color:"rocketOrange",children:s.workArrangement})})]}),e.jsx(k,{}),s.location&&e.jsxs(x,{children:[e.jsx(a,{fw:600,size:"sm",mb:5,children:"Location"}),e.jsxs(a,{size:"sm",children:[s.location.city,", ",s.location.region]})]}),e.jsxs(x,{children:[e.jsx(a,{fw:600,size:"sm",mb:5,children:"Job Description"}),e.jsx(a,{size:"sm",style:{whiteSpace:"pre-wrap"},children:s.jobDescription})]}),s.requirements&&s.requirements.length>0&&e.jsxs(x,{children:[e.jsx(a,{fw:600,size:"sm",mb:5,children:"Requirements"}),e.jsx(y,{size:"sm",spacing:"xs",children:s.requirements.map((n,m)=>e.jsx(y.Item,{children:n},m))})]}),s.advantages&&s.advantages.length>0&&e.jsxs(x,{children:[e.jsx(a,{fw:600,size:"sm",mb:5,children:"Advantages"}),e.jsx(y,{size:"sm",spacing:"xs",children:s.advantages.map((n,m)=>e.jsx(y.Item,{children:n},m))})]}),e.jsx(k,{}),s.apply&&e.jsxs(x,{children:[e.jsx(a,{fw:600,size:"sm",mb:5,children:"How to Apply"}),e.jsxs(a,{size:"sm",mb:5,children:["Apply via ",s.apply.method==="email"?"email":"external link",":"]}),s.apply.method==="email"?e.jsx(v,{href:`mailto:${s.apply.contact}`,target:"_blank",children:s.apply.contact}):e.jsx(v,{href:s.apply.contact,target:"_blank",children:s.apply.contact})]}),s.createdAt&&e.jsxs(a,{size:"xs",c:"dimmed",ta:"center",children:["Posted on ",new Date(s.createdAt).toLocaleDateString()]})]})});function ee(){const[d,p]=l.useState(!1),[s,n]=l.useState([]),[m,u]=l.useState(!1),[j,{open:h,close:A}]=D(!1),[c,S]=l.useState(null),[g,{open:L,close:z}]=D(!1),[o,r]=l.useState(null);l.useEffect(()=>{(async()=>{p(!0);try{const i=await E.get("/api/applications/my-applications");i.data.length>0?n(i.data):u(!0)}catch(i){w.show({title:"Error",message:i.response?.data?.message||i.message,color:"red"})}finally{setTimeout(()=>{p(!1)},1e3)}})()},[]);const q=t=>{S(t),h()},M=t=>{r(t),L()},T=()=>{(async()=>{try{const i=localStorage.getItem("token")||sessionStorage.getItem("token"),C=await E.get("/api/applications/my-applications",{headers:{"x-auth-token":i}});n(C.data)}catch{w.show({title:"Error",message:"Failed to refresh applications",color:"red"})}})()};return e.jsxs(e.Fragment,{children:[e.jsx($,{title:"Job Applications | JobRocket",description:"Manage your job applications on JobRocket",keywords:"job applications, manage job applications, job listings"}),d?e.jsx(O,{py:50,h:"calc(100vh - 200px)",children:e.jsx(H,{size:"xl",variant:"oval"})}):e.jsxs(b,{w:"100%",gap:"md",children:[e.jsx(I,{ta:"center",order:2,my:15,c:"rocketRed.9",children:"Applications"}),m?e.jsx(a,{children:"No applications found"}):null,e.jsx(K,{w:"100%",gap:"md",wrap:"wrap",align:"stretch",justify:"center",children:s.map((t,i)=>e.jsx(Q,{withBorder:!0,p:"md",w:"250px",style:{display:"flex"},children:e.jsxs(b,{h:"100%",w:"100%",justify:"space-between",style:{flex:1},children:[typeof t.listingId=="object"&&e.jsx(I,{order:5,children:t.listingId.companyName}),typeof t.listingId=="object"&&e.jsx(a,{children:t.listingId.jobTitle}),e.jsx(R,{variant:"outline",c:t.status==="rejected"?"red":t.status==="pending"?"yellow":"green",children:t.status}),e.jsxs(a,{fz:"sm",c:"dimmed",children:["Submitted on ",new Date(t.createdAt).toLocaleDateString()]}),e.jsx(N,{variant:"outline",onClick:()=>q(t.listingId),children:"View Listing"}),e.jsx(N,{variant:"outline",onClick:()=>M(t),disabled:t.status!=="pending",children:"Edit Application"})]})},i))})]}),e.jsx(X,{opened:j,onClose:A,listing:c}),e.jsx(W,{opened:g,onClose:z,application:o,onSuccess:T})]})}export{ee as MyApplications};
