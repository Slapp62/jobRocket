import{c as Z,a as q,r as h,j as e,M as ae,T as c,G as y,B as V,u as te,S as T,b as w,d as I,C as he,e as ie,f as ue,A as P,g as re,h as xe,i as Se,n as Te,k as Ae,l as Le,F as ze,m as K,o as se,p as B,R as Ce,W as De,q as _,P as J,s as oe,t as ke,L as Fe,v as Ie,w as W}from"./index-CU6HyXET.js";import{I as Y,T as a,a as ce}from"./IconTrash-B25C7zNj.js";import{c as Re}from"./getCleanedListingData-BmHcXBJ2.js";import{S as _e,l as Me}from"./listing.joi-bnSSVjTG.js";import{S as Ne,T as H,I as Ee,a as Oe}from"./IconUsers-COydMeDI.js";const Be=[["path",{d:"M7 12l5 5l10 -10",key:"svg-0"}],["path",{d:"M2 12l5 5m5 -5l5 -5",key:"svg-1"}]],Pe=Z("outline","checks","Checks",Be);const qe=[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 7v5l3 3",key:"svg-1"}]],$e=Z("outline","clock","Clock",qe);const We=[["path",{d:"M6 4h10l4 4v10a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2",key:"svg-0"}],["path",{d:"M12 14m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-1"}],["path",{d:"M14 4l0 4l-6 0l0 -4",key:"svg-2"}]],Ze=Z("outline","device-floppy","DeviceFloppy",We);const Ge=[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z",key:"svg-1"}],["path",{d:"M12 17v-6",key:"svg-2"}],["path",{d:"M9.5 14.5l2.5 2.5l2.5 -2.5",key:"svg-3"}]],de=Z("outline","file-download","FileDownload",Ge);const Ue=[["path",{d:"M18 6l-12 12",key:"svg-0"}],["path",{d:"M6 6l12 12",key:"svg-1"}]],Je=Z("outline","x","X",Ue);const He=[["path",{d:"M7 3.34a10 10 0 1 1 -4.995 8.984l-.005 -.324l.005 -.324a10 10 0 0 1 4.995 -8.336z",key:"svg-0"}]],Q=Z("filled","circle-filled","CircleFilled",He),ge=async()=>(await q.get("/api/applications/business/dashboard/metrics")).data,Ve=async l=>{const r=new URLSearchParams(Object.entries(l).filter(([d,n])=>n!==void 0&&n!=="All").map(([d,n])=>[d,String(n)])).toString();return(await q.get(`/api/listings/business-listings?${r}`)).data},Xe=async l=>{const r=new URLSearchParams(Object.entries(l).filter(([d,n])=>n!==void 0&&n!=="All"&&n!=="all").map(([d,n])=>[d,String(n)])).toString();return(await q.get(`/api/applications/business-applications?${r}`)).data},Ke=async(l,r)=>(await q.patch(`/api/applications/status/${l}`,{status:r})).data,Qe=async l=>(await q.delete(`/api/listings/${l}`)).data,Ye=async l=>(await q.delete(`/api/applications/${l}`)).data,es=({opened:l,onClose:r,handleDelete:u,applicationId:d,applicationTitle:n})=>{const[x,g]=h.useState(!1);return e.jsxs(ae,{opened:l,onClose:r,title:"Delete application",centered:!0,children:[e.jsxs(c,{children:["Are you sure you want to delete the",e.jsxs("span",{style:{fontWeight:"bold"},children:[" ",n," "]}),"application?"]}),e.jsxs(y,{mt:20,justify:"flex-end",gap:"sm",children:[e.jsx(V,{variant:"outline",onClick:r,children:"Cancel"}),e.jsx(V,{color:"red",onClick:()=>{r(),u(d)},loading:x,children:"Delete"})]})]})},ss=({dashApplications:l,searchText:r,setSearchText:u,status:d,setStatus:n,listingId:x,setListingId:g,dateFrom:L,setDateFrom:v,dateTo:m,setDateTo:b,sortOption:k,setSortOption:j,page:z,setPage:S,onStatusChange:M,listingOptions:t,updateApplicationStatus:o,newStatus:A,setNewStatus:C,handleApplicationDelete:E})=>{const[N,{open:F,close:i}]=te(!1),[$,ee]=h.useState(null),X=(s,O)=>{ee({id:s,title:O}),F()};return e.jsxs(e.Fragment,{children:[e.jsxs(T,{children:[e.jsxs(T,{gap:"md",hiddenFrom:"md",children:[e.jsx(w,{label:"Listing",value:x,onChange:s=>g(s),data:t}),e.jsx(I,{type:"date",label:"From",value:L||"",onChange:s=>v(s.target.value)}),e.jsx(I,{type:"date",label:"To",value:m||"",onChange:s=>b(s.target.value)}),e.jsx(w,{label:"Status",value:d,onChange:s=>n(s),data:[{value:"all",label:"All Statuses"},{value:"pending",label:"Pending"},{value:"reviewed",label:"Reviewed"},{value:"rejected",label:"Rejected"}]}),e.jsx(I,{label:"Search",value:r,onChange:s=>u(s.target.value),placeholder:"Search applications..."}),e.jsx(w,{label:"Sort",value:k,onChange:s=>j(s),data:[{value:"date-newest",label:"Newest First"},{value:"date-oldest",label:"Oldest First"},{value:"name-asc",label:"Name (A-Z)"},{value:"name-desc",label:"Name (Z-A)"}]})]}),e.jsxs(y,{justify:"center",align:"center",visibleFrom:"md",children:[e.jsx(w,{label:"Listing",w:"15%",value:x,onChange:s=>g(s),data:t}),e.jsx(I,{type:"date",label:"From",value:L||"",onChange:s=>v(s.target.value),w:"15%"}),e.jsx(I,{type:"date",label:"To",value:m||"",onChange:s=>b(s.target.value),w:"15%"}),e.jsx(w,{label:"Status",w:"15%",value:d,onChange:s=>n(s),data:[{value:"all",label:"All Statuses"},{value:"pending",label:"Pending"},{value:"reviewed",label:"Reviewed"},{value:"rejected",label:"Rejected"}]}),e.jsx(I,{label:"Search",w:"15%",value:r,onChange:s=>u(s.target.value),placeholder:"Search applications..."}),e.jsx(w,{label:"Sort",w:"15%",value:k,onChange:s=>j(s),data:[{value:"date-newest",label:"Newest First"},{value:"date-oldest",label:"Oldest First"},{value:"name-asc",label:"Name (A-Z)"},{value:"name-desc",label:"Name (Z-A)"}]})]}),l?.length===0?e.jsx(he,{mt:50,children:e.jsx(ie,{order:3,c:"red",children:"No Applications Found"})}):e.jsxs(e.Fragment,{children:[e.jsx(T,{hiddenFrom:"md",gap:"md",children:l?.map(s=>e.jsx(ue,{withBorder:!0,p:"md",children:e.jsxs(T,{gap:"xs",children:[e.jsxs(y,{justify:"space-between",children:[e.jsxs(c,{fw:600,size:"lg",children:[s.firstName," ",s.lastName]}),e.jsx(P,{size:36,variant:"outline",color:"red",onClick:()=>{X(s._id,`${typeof s.listingId=="object"&&s.listingId.jobTitle}`)},children:e.jsx(Y,{size:20})})]}),e.jsx(c,{size:"sm",c:"dimmed",children:typeof s.listingId=="object"&&s.listingId.jobTitle}),e.jsx(c,{size:"sm",children:s.email}),s.phone&&e.jsx(c,{size:"sm",children:s.phone}),e.jsxs(c,{size:"xs",c:"dimmed",children:["Submitted: ",s.createdAt&&new Date(s.createdAt).toLocaleString()]}),e.jsxs(y,{gap:"xs",mt:"xs",children:[e.jsx(re,{href:s.resumeUrl,target:"_blank",children:e.jsx(P,{variant:"light",size:36,children:e.jsx(de,{size:20})})}),e.jsx(w,{flex:1,value:A||s.status,onChange:O=>o(s._id,O),data:[{value:"pending",label:"Pending"},{value:"reviewed",label:"Reviewed"},{value:"rejected",label:"Rejected"}]})]})]})},s._id))}),e.jsx(xe,{visibleFrom:"md",children:e.jsx(a.ScrollContainer,{minWidth:900,children:e.jsxs(a,{verticalSpacing:"sm",maw:"100%",mx:"auto",children:[e.jsx(a.Thead,{children:e.jsxs(a.Tr,{children:[e.jsx(a.Th,{}),e.jsx(a.Th,{children:"Applicant"}),e.jsx(a.Th,{children:"Listing"}),e.jsx(a.Th,{children:"Phone"}),e.jsx(a.Th,{children:"Email"}),e.jsx(a.Th,{children:"Submitted"}),e.jsx(a.Th,{children:"Resume"}),e.jsx(a.Th,{children:"Status"}),e.jsx(a.Th,{children:"Actions"})]})}),e.jsx(a.Tbody,{children:l?.map(s=>e.jsxs(a.Tr,{children:[e.jsx(a.Td,{styles:{td:{borderLeft:"1px solid #eee",borderRight:"1px solid #eee"}},children:e.jsx(c,{fz:"sm",fw:"bold",c:"dimmed",ta:"center",children:l.indexOf(s)+1})}),e.jsx(a.Td,{children:e.jsxs(c,{fz:"sm",fw:500,children:[s.firstName," ",s.lastName]})}),e.jsx(a.Td,{children:e.jsx(c,{fz:"sm",fw:500,children:typeof s.listingId=="object"&&s.listingId.jobTitle})}),e.jsx(a.Td,{children:e.jsx(c,{fz:"sm",fw:500,children:s.phone})}),e.jsx(a.Td,{children:e.jsx(c,{fz:"sm",children:s.email})}),e.jsx(a.Td,{children:s.createdAt&&new Date(s.createdAt).toLocaleString()}),e.jsx(a.Td,{children:e.jsx(re,{href:s.resumeUrl,target:"_blank",children:e.jsx(de,{size:30})})}),e.jsx(a.Td,{children:e.jsx(w,{px:5,value:A||s.status,onChange:O=>o(s._id,O),data:[{value:"pending",label:"Pending"},{value:"reviewed",label:"Reviewed"},{value:"rejected",label:"Rejected"}]})}),e.jsx(a.Td,{styles:{td:{borderRight:"1px solid #eee"}},children:e.jsx(y,{gap:"xs",children:e.jsx(P,{size:30,variant:"outline",color:"red",onClick:()=>{X(s._id,`${typeof s.listingId=="object"&&s.listingId.jobTitle}`)},children:e.jsx(Y,{size:25,stroke:1.5})})})})]},s._id))})]})})})]})]}),e.jsx(es,{opened:N,onClose:i,applicationId:$?.id||"",applicationTitle:$?.title||"",handleDelete:E})]})},ts=({opened:l,onClose:r,handleDelete:u,listingId:d,listingTitle:n})=>{const[x,g]=h.useState(!1);return e.jsxs(ae,{opened:l,onClose:r,title:"Delete Listing",centered:!0,children:[e.jsxs(c,{children:["Are you sure you want to delete the",e.jsxs("span",{style:{fontWeight:"bold"},children:[" ",n," "]}),"listing?"]}),e.jsxs(y,{mt:20,justify:"flex-end",gap:"sm",children:[e.jsx(V,{variant:"outline",onClick:r,children:"Cancel"}),e.jsx(V,{color:"red",onClick:()=>{r(),u(d)},loading:x,children:"Delete"})]})]})},as=({opened:l,onClose:r,listing:u,setListings:d})=>{const[n,x]=h.useState(!1),{register:g,handleSubmit:L,reset:v,formState:{errors:m,isValid:b,isDirty:k},control:j}=Se({mode:"all",resolver:Te(Me)});h.useEffect(()=>{if(l&&u){const t=Re(u);v(t)}},[l]);const z=Ae({control:j,name:"location.region"}),S=h.useMemo(()=>z?Le(z).map(t=>({value:t,label:t})):[],[z]),M=async t=>{try{x(!0);const o=await q.put(`/api/listings/${u?._id}`,{...t,expiresAt:t.expiresAt?new Date(t.expiresAt).toISOString():null});d(A=>A.map(C=>C._id===o.data._id?o.data:C)),_.show({title:"Success",message:"Listing updated successfully!",color:"green"}),r()}catch(o){_.show({title:"Error",message:`Update failed! ${o?.response?.data?.message||o.message}`,color:"red"})}finally{x(!1)}};return e.jsx(ae,{opened:l,onClose:r,title:"Delete application",centered:!0,size:"xl",zIndex:100,children:e.jsxs(T,{gap:"md",p:"md",children:[e.jsx(ze,{justify:"space-between",align:"center",children:e.jsx(ie,{order:2,children:"Edit Listing"})}),e.jsx("form",{onSubmit:L(M),children:e.jsxs(T,{gap:"md",children:[e.jsx(K,{legend:"Job Info",children:e.jsxs(T,{gap:"sm",children:[e.jsx(I,{label:"Company Name",required:!0,...g("companyName"),error:m.companyName?.message}),e.jsx(I,{label:"Job Title",required:!0,...g("jobTitle"),error:m.jobTitle?.message}),e.jsx(se,{label:"Job Description",required:!0,minRows:4,...g("jobDescription"),error:m.jobDescription?.message}),e.jsx(B,{name:"requirements",control:j,render:({field:t})=>e.jsx(se,{label:"Requirements",placeholder:"Add one requirement per line",minRows:3,value:(t.value||[]).join(`
`),onChange:o=>{const A=o.currentTarget.value.split(`
`).map(C=>C.trim()).filter(Boolean);t.onChange(A)},error:m.requirements?.message})}),e.jsx(B,{name:"advantages",control:j,render:({field:t})=>e.jsx(se,{label:"Nice to Have",placeholder:"Add one advantage per line",minRows:3,value:(t.value||[]).join(`
`),onChange:o=>{const A=o.currentTarget.value.split(`
`).map(C=>C.trim()).filter(Boolean);t.onChange(A)},error:m.advantages?.message})})]})}),e.jsx(K,{legend:"Application",children:e.jsxs(T,{gap:"sm",children:[e.jsx(B,{name:"apply.method",control:j,render:({field:t})=>e.jsx(w,{label:"Application Method",required:!0,data:[{value:"email",label:"Email"},{value:"link",label:"External Link"}],...t,error:m.apply?.method?.message})}),e.jsx(I,{label:"Application Contact / URL",required:!0,...g("apply.contact"),error:m.apply?.contact?.message})]})}),e.jsx(K,{legend:"Location",children:e.jsxs(T,{gap:"sm",children:[e.jsx(B,{name:"location.region",control:j,render:({field:t})=>e.jsx(w,{label:"Region",required:!0,searchable:!0,data:Ce.map(o=>({value:o,label:o})),...t,error:m.location?.region?.message})}),e.jsx(B,{name:"location.city",control:j,render:({field:t})=>e.jsx(w,{label:"City",required:!0,searchable:!0,disabled:!z,data:S,...t,error:m.location?.city?.message})})]})}),e.jsx(K,{legend:"Job Details",children:e.jsxs(T,{gap:"sm",children:[e.jsx(B,{name:"workArrangement",control:j,render:({field:t})=>e.jsx(w,{label:"Work Arrangement",required:!0,searchable:!0,data:De.map(o=>({value:o,label:o})),...t,error:m.workArrangement?.message})}),e.jsx(B,{name:"isActive",control:j,render:({field:t})=>e.jsx(_e,{label:"Listing is active",checked:t.value,onChange:o=>t.onChange(o.currentTarget.checked)})}),e.jsx(I,{label:"Expiration Date",type:"date",...g("expiresAt"),error:m.expiresAt?.message})]})}),e.jsx(y,{justify:"space-between",mt:"md",children:e.jsx(V,{type:"submit",variant:"filled",color:"green",leftSection:e.jsx(Ze,{size:16}),disabled:!b||!k,loading:n,children:"Save Changes"})})]})})]})})},is=({listings:l,handleDelete:r,searchText:u,setSearchText:d,sortOption:n,setSortOption:x,activeFilter:g,setActiveFilter:L,page:v,setPage:m,setListings:b})=>{const[k,{open:j,close:z}]=te(!1),[S,M]=h.useState(null),[t,{open:o,close:A}]=te(!1),[C,E]=h.useState(),N=(i,$)=>{M({id:i,title:$}),j()},F=i=>{E(i),o()};return e.jsxs(e.Fragment,{children:[e.jsxs(T,{children:[e.jsxs(T,{gap:"md",hiddenFrom:"md",children:[e.jsx(I,{label:"Search listings",placeholder:"Search listings",value:u,onChange:i=>d(i.target.value)}),e.jsx(w,{label:"Sort by",placeholder:"Select sort option",value:n,onChange:i=>{x(i)},data:[{value:"all",label:"All Listings"},{value:"date-created-new",label:"Newest First"},{value:"date-created-old",label:"Oldest First"},{value:"favorites-most",label:"Most Favorited"},{value:"favorites-least",label:"Least Favorited"},{value:"title-asc",label:"Title A-Z"},{value:"title-desc",label:"Title Z-A"}]}),e.jsx(w,{label:"Filter by status",placeholder:"Select active filter",value:g,onChange:i=>{L(i)},data:[{value:"all",label:"All Listings"},{value:"active",label:"Active"},{value:"inactive",label:"Inactive"}]})]}),e.jsxs(y,{justify:"center",visibleFrom:"md",children:[e.jsx(I,{label:"Search listings",placeholder:"Search listings",value:u,onChange:i=>d(i.target.value)}),e.jsx(w,{label:"Sort by",placeholder:"Select sort option",value:n,onChange:i=>{x(i)},data:[{value:"all",label:"All Listings"},{value:"date-created-new",label:"Newest First"},{value:"date-created-old",label:"Oldest First"},{value:"favorites-most",label:"Most Favorited"},{value:"favorites-least",label:"Least Favorited"},{value:"title-asc",label:"Title A-Z"},{value:"title-desc",label:"Title Z-A"}]}),e.jsx(w,{label:"Filter by status",placeholder:"Select active filter",value:g,onChange:i=>{L(i)},data:[{value:"all",label:"All Listings"},{value:"active",label:"Active"},{value:"inactive",label:"Inactive"}]})]}),e.jsx(T,{hiddenFrom:"md",gap:"md",children:l?.map(i=>e.jsx(ue,{withBorder:!0,p:"md",children:e.jsxs(T,{gap:"xs",children:[e.jsxs(y,{justify:"space-between",align:"start",children:[e.jsx("div",{children:e.jsx(c,{fw:600,size:"lg",children:i.jobTitle})}),i.isActive?e.jsx(Q,{size:20,color:"green"}):e.jsx(Q,{size:20,color:"red"})]}),e.jsxs(y,{gap:"xs",children:[e.jsxs(c,{size:"xs",c:"dimmed",children:["Created: ",i.createdAt&&new Date(i.createdAt).toLocaleDateString()]}),e.jsx(c,{size:"xs",c:"dimmed",children:"â€¢"}),e.jsxs(c,{size:"xs",c:"dimmed",children:[i.likes?.length||0," favorites"]})]}),i.expiresAt&&e.jsxs(c,{size:"xs",c:"dimmed",children:["Expires: ",i.expiresAt]}),e.jsxs(y,{gap:"xs",mt:"xs",children:[e.jsx(P,{size:36,variant:"outline",color:"yellow",onClick:()=>F(i),children:e.jsx(ce,{size:20})}),e.jsx(P,{size:36,variant:"outline",color:"red",onClick:()=>N(i._id,i.jobTitle),children:e.jsx(Y,{size:20})})]})]})},i._id))}),e.jsx(xe,{visibleFrom:"md",children:e.jsx(a.ScrollContainer,{minWidth:800,children:e.jsxs(a,{verticalSpacing:"sm",maw:"100%",mx:"auto",children:[e.jsx(a.Thead,{children:e.jsxs(a.Tr,{children:[e.jsx(a.Th,{}),e.jsx(a.Th,{children:"Job Title"}),e.jsx(a.Th,{children:"Created At"}),e.jsx(a.Th,{children:"Expires At"}),e.jsx(a.Th,{children:"Active"}),e.jsx(a.Th,{children:"Favorites"}),e.jsx(a.Th,{children:"Edit"}),e.jsx(a.Th,{children:"Delete"})]})}),e.jsx(a.Tbody,{children:l?.map(i=>e.jsxs(a.Tr,{children:[e.jsx(a.Td,{styles:{td:{borderLeft:"1px solid #eee",borderRight:"1px solid #eee"}},children:e.jsx(c,{fz:"sm",fw:"bold",c:"dimmed",ta:"center",children:l.indexOf(i)+1})}),e.jsx(a.Td,{children:e.jsx(c,{fz:"sm",fw:500,children:i.jobTitle})}),e.jsx(a.Td,{children:i.createdAt&&new Date(i.createdAt).toLocaleString()}),e.jsx(a.Td,{children:e.jsx(c,{fz:"sm",children:i.expiresAt})}),e.jsx(a.Td,{children:i.isActive===!0?e.jsx(Q,{size:16,color:"green"}):e.jsx(Q,{size:16,color:"red"})}),e.jsx(a.Td,{children:e.jsx(c,{fz:"sm",children:i.likes?.length})}),e.jsx(a.Td,{children:e.jsx(P,{size:30,variant:"outline",color:"yellow",onClick:()=>F(i),children:e.jsx(ce,{size:25,stroke:1.5})})}),e.jsx(a.Td,{styles:{td:{borderRight:"1px solid #eee"}},children:e.jsx(P,{size:30,variant:"outline",color:"red",onClick:()=>N(i._id,i.jobTitle),children:e.jsx(Y,{size:25,stroke:1.5})})})]},i._id))})]})})})]}),e.jsx(as,{opened:t,onClose:A,listing:C,setListings:b}),e.jsx(ts,{opened:k,onClose:z,listingId:S?.id||"",listingTitle:S?.title||"",handleDelete:r})]})},ls=({dashboardMetrics:l})=>e.jsx(Ne,{cols:{base:1,xs:2,sm:3,md:5},spacing:"md",children:e.jsxs(e.Fragment,{children:[e.jsxs(J,{shadow:"sm",p:"md",radius:"md",withBorder:!0,className:oe.cardGradientSubtle,children:[e.jsxs(y,{justify:"space-between",mb:"xs",children:[e.jsx(c,{size:"xs",c:"dimmed",fw:700,tt:"uppercase",children:"Total Applications"}),e.jsx(H,{color:"rocketOrange",variant:"light",size:"lg",radius:"md",children:e.jsx(Ee,{size:20})})]}),e.jsx(c,{size:"xl",fw:700,children:l?.metrics?.totalApplications||0})]}),e.jsxs(J,{shadow:"sm",p:"md",radius:"md",withBorder:!0,className:oe.cardGradientRed,children:[e.jsxs(y,{justify:"space-between",mb:"xs",children:[e.jsx(c,{size:"xs",c:"dimmed",fw:700,tt:"uppercase",children:"Total Listings"}),e.jsx(H,{color:"rocketRed",variant:"light",size:"lg",radius:"md",children:e.jsx(Oe,{size:20})})]}),e.jsx(c,{size:"xl",fw:700,children:l?.metrics?.totalListings||0})]}),e.jsxs(J,{shadow:"sm",p:"md",radius:"md",withBorder:!0,children:[e.jsxs(y,{justify:"space-between",mb:"xs",children:[e.jsx(c,{size:"xs",c:"dimmed",fw:700,tt:"uppercase",children:"Pending"}),e.jsx(H,{color:"yellow",variant:"light",size:"lg",radius:"md",children:e.jsx($e,{size:20})})]}),e.jsx(c,{size:"xl",fw:700,children:l?.metrics?.pendingApplications||0})]}),e.jsxs(J,{shadow:"sm",p:"md",radius:"md",withBorder:!0,children:[e.jsxs(y,{justify:"space-between",mb:"xs",children:[e.jsx(c,{size:"xs",c:"dimmed",fw:700,tt:"uppercase",children:"Reviewed"}),e.jsx(H,{color:"green",variant:"light",size:"lg",radius:"md",children:e.jsx(Pe,{size:20})})]}),e.jsx(c,{size:"xl",fw:700,children:l?.metrics?.reviewedApplications||0})]}),e.jsxs(J,{shadow:"sm",p:"md",radius:"md",withBorder:!0,children:[e.jsxs(y,{justify:"space-between",mb:"xs",children:[e.jsx(c,{size:"xs",c:"dimmed",fw:700,tt:"uppercase",children:"Rejected"}),e.jsx(H,{color:"red",variant:"light",size:"lg",radius:"md",children:e.jsx(Je,{size:20})})]}),e.jsx(c,{size:"xl",fw:700,children:l?.metrics?.rejectedApplications||0})]})]})}),ns=()=>{const[l,r]=h.useState([]),[u,d]=h.useState(!1),[n,x]=h.useState(""),[g,L]=h.useState("all"),[v,m]=h.useState("date-created-new"),[b,k]=h.useState(1),j=async()=>{d(!0);try{const t=await Ve({searchWord:n||void 0,sortOption:v,page:b,limit:20});r(t.listings)}catch(t){_.show({title:"Error",message:t.response?.data?.message||"Failed to load listings",color:"red"})}finally{d(!1)}},z=t=>l.filter(o=>o._id!==t);h.useEffect(()=>{j()},[n,v,b]);const S=l.filter(t=>{if(g==="all")return!0;if(g==="active")return t.isActive===!0;if(g==="inactive")return t.isActive===!1});return{listings:v?.startsWith("favorites")?v==="favorites-least"?S.sort((t,o)=>(t.likes?.length||0)-(o.likes?.length||0)):S.sort((t,o)=>(o.likes?.length||0)-(t.likes?.length||0)):S,setListings:r,isLoading:u,searchText:n,activeFilter:g,sortOption:v,page:b,setSearchText:x,setActiveFilter:L,setSortOption:m,setPage:k,refetchListings:j,removeListingById:z}},rs=()=>{const[l,r]=h.useState([]),[u,d]=h.useState(!1),[n,x]=h.useState(""),[g,L]=h.useState("all"),[v,m]=h.useState("all"),[b,k]=h.useState(""),[j,z]=h.useState(""),[S,M]=h.useState("date-newest"),[t,o]=h.useState(1),[A,C]=h.useState(null),E=N=>l.filter(F=>F._id!==N);return h.useEffect(()=>{(async()=>{d(!0);try{const F=await Xe({searchText:n||void 0,status:g,listingId:v,dateFrom:b||void 0,dateTo:j||void 0,sortOption:S,page:t,limit:20});r(F.applications)}catch(F){_.show({title:"Error",message:F.response?.data?.message||"Failed to load applications",color:"red"})}finally{d(!1)}})()},[n,g,v,b,j,S,t]),{applications:l,isLoading:u,searchText:n,status:g,listingId:v,dateFrom:b,dateTo:j,sortOption:S,page:t,setSearchText:x,setStatus:L,setListingId:m,setDateFrom:k,setDateTo:z,setSortOption:M,setPage:o,newStatus:A,setNewStatus:C,setApplications:r,removeApplicationById:E}},os=()=>{const[l,r]=h.useState(!1),[u,d]=h.useState(),n=async()=>{try{r(!0);const x=await ge();d(x)}catch(x){_.show({title:"Error",message:x.response?.data?.message||x.message,color:"red"})}finally{r(!1)}};return h.useEffect(()=>{n()},[]),{dashboardMetrics:u,setDashboardMetrics:d,getDashboardMetrics:n}},gs=()=>{const[l,r]=h.useState(!1),{dashboardMetrics:u,setDashboardMetrics:d}=os(),{listings:n,setListings:x,isLoading:g,searchText:L,setSearchText:v,sortOption:m,setSortOption:b,activeFilter:k,setActiveFilter:j,page:z,setPage:S,removeListingById:M}=ns(),{applications:t,searchText:o,setSearchText:A,status:C,setStatus:E,listingId:N,setListingId:F,dateFrom:i,setDateFrom:$,dateTo:ee,setDateTo:X,sortOption:s,setSortOption:O,page:je,setPage:me,newStatus:pe,setNewStatus:ve,setApplications:le,removeApplicationById:be}=rs(),fe=[{value:"all",label:"All Listings"},...n.map(D=>({value:D._id,label:D.jobTitle}))??[]],we=async D=>{if(!D)return;const R=M(D);x(R);try{await Qe(D),_.show({title:"Success",message:"Listing deleted successfully",color:"green"})}catch(f){_.show({title:"Error",message:f.response?.data?.message||"Failed to delete listing",color:"red"})}d(f=>f&&{...f,metrics:{...f.metrics,totalListings:R.length}})},ye=async D=>{if(!D)return;const R=be(D);le(R);try{await Ye(D),_.show({title:"Success",message:"Application deleted successfully",color:"green"})}catch(f){_.show({title:"Error",message:f.response?.data?.message||"Failed to delete application",color:"red"})}d(f=>f&&{...f,metrics:{...f.metrics,totalApplications:R.length,pendingApplications:R.filter(p=>p.status==="pending").length,reviewedApplications:R.filter(p=>p.status==="reviewed").length,rejectedApplications:R.filter(p=>p.status==="rejected").length}})},ne=async(D,R)=>{if(!R)return;const f=R;try{await Ke(D,f);const p=await ge();d(p)}catch(p){_.show({title:"Error",message:p.response?.data?.message||"Failed to update application status",color:"red"})}le(p=>p&&p.map(G=>G._id===D?{...G,status:f}:G)),d(p=>{if(!p)return p;const G={pendingApplications:t.filter(U=>U.status==="pending").length,reviewedApplications:t.filter(U=>U.status==="reviewed").length,rejectedApplications:t.filter(U=>U.status==="rejected").length};return{...p,metrics:{...p.metrics,updatedMetrics:G}}})};return e.jsxs(e.Fragment,{children:[e.jsx(ke,{title:"Dashboard | JobRocket",description:"Manage your listings and applications.",keywords:"analytics, dashboard, job applications, manage job applications, manage job listings"}),l?e.jsx(he,{py:50,h:"calc(100vh - 200px)",children:e.jsx(Fe,{size:"xl",variant:"oval"})}):e.jsx(Ie,{size:"xl",py:"xl",w:{base:"100%",sm:"95%",md:"85%"},children:e.jsxs(T,{gap:"xl",children:[e.jsxs("div",{children:[e.jsx(ie,{order:1,mb:"xs",children:"Dashboard"}),e.jsx(c,{c:"dimmed",size:"lg",children:"Welcome back! Here's your overview"})]}),e.jsx(ls,{dashboardMetrics:u}),e.jsxs(W,{color:"rocketOrange",variant:"outline",defaultValue:"applications",children:[e.jsxs(W.List,{mb:20,justify:"center",fw:600,children:[e.jsx(W.Tab,{value:"applications",fz:{base:"lg",md:30},children:"Applications"}),e.jsx(W.Tab,{value:"listings",fz:{base:"lg",md:30},children:"Listings"})]}),e.jsx(W.Panel,{value:"applications",children:e.jsx(ss,{dashApplications:t,listingOptions:fe,onStatusChange:ne,searchText:o,setSearchText:A,status:C,setStatus:E,listingId:N,setListingId:F,dateFrom:i,setDateFrom:$,dateTo:ee,setDateTo:X,sortOption:s,setSortOption:O,page:je,setPage:me,updateApplicationStatus:ne,newStatus:pe,setNewStatus:ve,handleApplicationDelete:ye})}),e.jsx(W.Panel,{value:"listings",children:e.jsx(is,{listings:n,isLoading:g,searchText:L,setSearchText:v,sortOption:m,setSortOption:b,activeFilter:k,setActiveFilter:j,page:z,setPage:S,handleDelete:we,setListings:x})})]})]})})]})};export{gs as Dashboard};
