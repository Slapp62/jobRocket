import{K as q,H as k,r as p,J as E,i as N,k as T,l as L,j as e,t as J,P,e as D,F as h,m,d,o as x,p as i,b as u,R as I,W as M,B,n as F,a as W,q as y}from"./index-CU6HyXET.js";import{S as O,l as G}from"./listing.joi-bnSSVjTG.js";function V(){const v=q(),f=k("(max-width: 700px)"),[A,b]=p.useState(!1),o=E(a=>a.userSlice.user),{reset:j,register:l,handleSubmit:C,control:t,formState:{errors:s,isValid:S}}=N({mode:"all",resolver:F(G),defaultValues:{companyName:"",requirements:[],advantages:[],apply:{method:"email",contact:""},location:{region:"",city:""},workArrangement:"",isActive:!0,expiresAt:""}});p.useEffect(()=>{o&&j({companyName:o.businessProfile?.companyName,location:{region:o.businessProfile?.location.region,city:o.businessProfile?.location.city}})},[o,j]);const c=T({control:t,name:"location.region"}),w=p.useMemo(()=>c?L(c).map(a=>({value:a,label:a})):[],[c]),R=async a=>{const r={...a,expiresAt:a.expiresAt?new Date(a.expiresAt).toISOString():null};b(!0);try{(await W.post("/api/listings/",r)).status===201&&(y.show({title:"Success",message:"Listing created!",color:"green"}),v("/dashboard"))}catch(n){y.show({title:"Error",message:`Listing creation failed! ${n?.response?.data||n.message}`,color:"red"})}finally{b(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(J,{title:"Post a Job | JobRocket",description:"Create a new job listing and reach English-speaking candidates in Israel",keywords:"post job, create listing, hire employees, job posting"}),e.jsxs(P,{children:[e.jsx(D,{ta:"center",my:10,children:"Create A Listing"}),e.jsxs("form",{onSubmit:C(R),children:[e.jsxs(h,{direction:"column",gap:10,py:10,mx:"auto",style:{width:f?"90%":"50%"},children:[e.jsxs(m,{legend:"Job Info",children:[e.jsx(d,{label:"Company Name",required:!0,...l("companyName"),error:s.companyName?.message}),e.jsx(d,{label:"Job Title",required:!0,...l("jobTitle"),error:s.jobTitle?.message}),e.jsx(x,{label:"Job Description",minRows:4,required:!0,...l("jobDescription"),error:s.jobDescription?.message}),e.jsx(i,{name:"requirements",control:t,render:({field:a})=>e.jsx(x,{label:"Requirements",placeholder:"Add one requirement per line",minRows:3,value:(a.value||[]).join(`
`),onChange:r=>{const n=r.currentTarget.value.split(`
`).map(g=>g.trim()).filter(Boolean);a.onChange(n)},error:s.requirements?.message})}),e.jsx(i,{name:"advantages",control:t,render:({field:a})=>e.jsx(x,{label:"Nice to Have",placeholder:"Add one advantage per line",minRows:3,value:(a.value||[]).join(`
`),onChange:r=>{const n=r.currentTarget.value.split(`
`).map(g=>g.trim()).filter(Boolean);a.onChange(n)},error:s.advantages?.message})})]}),e.jsxs(m,{legend:"Application",children:[e.jsx(i,{name:"apply.method",control:t,render:({field:a})=>e.jsx(u,{label:"Application Method",required:!0,data:[{value:"email",label:"Email"},{value:"link",label:"External Link"}],...a,error:s.apply?.method?.message})}),e.jsx(d,{label:"Application Contact / URL",required:!0,...l("apply.contact"),error:s.apply?.contact?.message})]}),e.jsxs(m,{legend:"Location",children:[e.jsx(i,{name:"location.region",control:t,render:({field:a})=>e.jsx(u,{label:"Region",required:!0,searchable:!0,data:I.map(r=>({value:r,label:r})),...a,error:s.location?.region?.message})}),e.jsx(i,{name:"location.city",control:t,render:({field:a})=>e.jsx(u,{label:"City",required:!0,searchable:!0,disabled:!c,data:w,...a,error:s.location?.city?.message})})]}),e.jsxs(m,{legend:"Job Details",children:[e.jsx(i,{name:"workArrangement",control:t,render:({field:a})=>e.jsx(u,{label:"Work Arrangement",required:!0,searchable:!0,data:M.map(r=>({value:r,label:r})),...a,error:s.workArrangement?.message})}),e.jsx(i,{name:"isActive",control:t,render:({field:a})=>e.jsx(O,{label:"Listing is active",checked:a.value,onChange:r=>a.onChange(r.currentTarget.checked)})}),e.jsx(d,{label:"Expiration Date",type:"date",...l("expiresAt"),error:s.expiresAt?.message})]})]}),e.jsx(h,{justify:"center",my:10,children:e.jsx(B,{type:"submit",size:"lg",disabled:!S,loading:A,children:"Create"})})]})]})]})}export{V as CreateListing};
